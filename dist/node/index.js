"use strict";var W=Object.defineProperty;var we=Object.getOwnPropertyDescriptor;var Oe=Object.getOwnPropertyNames;var Fe=Object.prototype.hasOwnProperty;var Be=(e,t)=>{for(var a in t)W(e,a,{get:t[a],enumerable:!0})},Ie=(e,t,a,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Oe(t))!Fe.call(e,o)&&o!==a&&W(e,o,{get:()=>t[o],enumerable:!(n=we(t,o))||n.enumerable});return e};var Ae=e=>Ie(W({},"__esModule",{value:!0}),e);var Ne={};Be(Ne,{createApiFetcher:()=>Qe,fetchf:()=>Ue});module.exports=Ae(Ne);async function T(e,t){if(t){if(typeof t=="function"){let a=await t(e);a&&Object.assign(e,a)}else if(Array.isArray(t))for(let a of t){let n=await a(e);n&&Object.assign(e,n)}}}var _=class extends Error{status;statusText;request;config;response;constructor(t,a,n){super(t),this.name="FetchError",this.message=t,this.status=n?.status||0,this.statusText=n?.statusText||"",this.request=a,this.config=a,this.response=n}};var k=class extends _{constructor(t,a,n){super(t,a,n),this.name="ResponseError"}};var M="application/",A=M+"json",ie="charset=utf-8",b="Content-Type",q="undefined",C="object",L="string",j="AbortError",ue="TimeoutError",le="CanceledError",H="GET",ce="HEAD";function X(e){return e instanceof URLSearchParams}function pe(e){let t="";for(let a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t+=a+":"+e[a]);return t}function Z(e){let t={},a=Object.keys(e);a.sort();for(let n=0,o=a.length;n<o;n++){let R=a[n];t[R]=e[R]}return t}function fe(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function de(e,t){if(!t)return e;if(X(t)){let f=t.toString();return fe(e,f)}let a=[],n=encodeURIComponent,o=(f,r)=>{r=typeof r=="function"?r():r,r=r===null||r===void 0?"":r,a[a.length]=n(f)+"="+n(r)},R=(f,r)=>{let p,g,m;if(f)if(Array.isArray(r))for(p=0,g=r.length;p<g;p++)R(f+"["+(typeof r[p]===C&&r[p]?p:"")+"]",r[p]);else if(typeof r===C&&r!==null)for(m in r)R(f+"["+m+"]",r[m]);else o(f,r);else if(Array.isArray(r))for(p=0,g=r.length;p<g;p++)o(r[p].name,r[p].value);else for(m in r)R(m,r[m]);return a},P=R("",t).join("&").replace(/%5B%5D/g,"[]");return fe(e,P)}function Re(e,t){return t?e.replace(/:\w+/g,a=>{let n=a.substring(1);return t[n]?String(t[n]):a}):e}function me(e){let t=typeof e;if(t===q||e===null)return!1;if(t===L||t==="number"||t==="boolean"||Array.isArray(e))return!0;if(typeof globalThis!==q&&typeof globalThis.Buffer!==q&&globalThis.Buffer.isBuffer(e)||e instanceof Date)return!1;if(t===C){let a=Object.getPrototypeOf(e);if(a===Object.prototype||a===null||typeof e.toJSON=="function")return!0}return!1}async function ee(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function te(e){return e&&typeof e===C&&typeof e.data!==q&&Object.keys(e).length===1?te(e.data):e}function ye(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((a,n)=>{t[n]=a});else if(typeof e===C&&e!==null)for(let[a,n]of Object.entries(e))t[a.toLowerCase()]=n;return t}var Q=new Map;async function Pe(e,t,a=0,n=!1,o=!0){let R=Date.now(),h=Q.get(e);if(h){let r=h[3],p=h[0],g=h[1];if(!r&&R-h[2]<a)return p;r&&p.abort(new DOMException("Aborted due to new request",j)),g!==null&&clearTimeout(g),Q.delete(e)}let P=new AbortController,f=o?setTimeout(()=>{let r=new DOMException(`${e.url} aborted due to timeout`,ue);v(e,r)},t):null;return Q.set(e,[P,f,R,n]),P}async function v(e,t=null){let a=Q.get(e);if(a){let n=a[0],o=a[1];t&&!n.signal.aborted&&n.abort(t),o!==null&&clearTimeout(o),Q.delete(e)}}async function he(e){if(!e?.body)return null;let t=String(e.headers?.get(b)||"").split(";")[0],a;try{if(t.includes(A)||t.includes("+json"))a=await e.json();else if(t.includes("multipart/form-data"))a=await e.formData();else if(t.includes(M+"octet-stream"))a=await e.blob();else if(t.includes(M+"x-www-form-urlencoded"))a=await e.formData();else if(t.includes("text/"))a=await e.text();else try{a=await e.clone().json()}catch{a=await e.text()}}catch{a=null}return a}function J(e){let t=0;for(let a=0,n=e.length;a<n;a++){let o=e.charCodeAt(a);t=t*31+o|0}return String(t)}var ae=new Map;function ge(e){let{url:t="",method:a=H,headers:n={},body:o="",mode:R="cors",credentials:h="include",cache:P="default",redirect:f="follow",referrer:r="",integrity:p=""}=e;if(P==="reload")return"";let g=pe(Z(n)),m="";if(o!==null)if(typeof o=="string")m=J(o);else if(o instanceof FormData)o.forEach((w,O)=>{m+=O+"="+w+"&"}),m=J(m);else if(typeof Blob!==q&&o instanceof Blob||typeof File!==q&&o instanceof File)m="BF"+o.size+o.type;else if(o instanceof ArrayBuffer||ArrayBuffer.isView(o))m="AB"+o.byteLength;else{let w=typeof o===C?Z(o):String(o);m=J(JSON.stringify(w))}return a+t+R+h+P+f+r+p+g+m}function He(e,t){return t?Date.now()-e>t*1e3:!1}function De(e,t){let a=ae.get(e);if(a){if(!He(a.timestamp,t))return a;ae.delete(e)}return null}function Ce(e,t,a=!1){ae.set(e,{data:t,isLoading:a,timestamp:Date.now()})}var se={method:H,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:A+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function $(e){let t={...se,...e},a=(s,i,c,d)=>{d[s]&&(i[s]={...c[s],...d[s]})};a("retry",t,se,e),a("headers",t,se,e);let n=(s,i)=>typeof s[i]!==q?s[i]:t[i],o=n(e,"fetcher"),R=o?.create(t)||null,h=()=>R,P=(s,...i)=>{let c=n(s,"logger");c?.warn&&c.warn(...i)},f=(s,i,c)=>{if(!(!c&&["PUT","DELETE"].includes(i))){let d=A+";"+ie;s instanceof Headers?s.has(b)||s.set(b,d):typeof s===C&&!Array.isArray(s)&&!s[b]&&(s[b]=d)}},r=(s,i)=>{let c=n(i,"method").toUpperCase(),d=c===H||c===ce,u=Re(s,n(i,"urlPathParams")),y=n(i,"params"),U=n(i,"body")||n(i,"data"),D;d||(D=U);let N=n(i,"headers");f(N,c,D);let S=n(i,"withCredentials")?"include":n(i,"credentials"),x=y?de(u,y):u,E=x.includes("://")?"":n(i,"baseURL")||n(i,"apiUrl");return D&&typeof D!==L&&!X(D)&&me(D)&&(D=JSON.stringify(D)),{...i,credentials:S,body:D,method:c,headers:N,url:E+x}},p=async(s,i)=>{m(s)||P(i,"API ERROR",s),await T(s,i?.onError),await T(s,t?.onError)},g=async(s,i,c)=>{let d=m(s),u=n(c,"strategy"),y=n(c,"rejectCancelled");if(!(d&&!y)){if(u==="silent")await new Promise(()=>null);else if(u==="reject")return Promise.reject(s)}return O(i,c,s)},m=s=>s.name===j||s.name===le,w=async(s,i=null)=>{let c=i||{},d={...t,...c};a("retry",d,t,c),a("headers",d,t,c);let u=null,y=r(s,d),{timeout:U,cancellable:D,dedupeTime:N,pollingInterval:G,shouldStopPolling:S,cacheTime:x,cacheKey:z}=d,E;if(z?E=z(y):E=ge(y),x&&E){let I=d.cacheBuster;if(!I||!I(y)){let l=De(E,x);if(l)return l.data}}let{retries:K=0,delay:qe,backoff:Ee,retryOn:Te,shouldRetry:ne,maxDelay:be,resetTimeout:xe}=d.retry,F=0,V=0,B=qe,re=K>0?K:0;for(;F<=re;)try{let l={signal:(await Pe(y,U,N,D,!!(U&&(!re||xe)))).signal,...y};if(await T(l,c?.onRequest),await T(l,t?.onRequest),o!==null&&R!==null?u=await R.request(l):u=await fetch(l.url,l),u instanceof Response&&(u.config=l,u.data=await he(u),!u.ok))throw new k(`${l.url} failed! Status: ${u.status||null}`,l,u);if(await T(u,c?.onResponse),await T(u,t?.onResponse),v(y),G&&(!S||!S(u,V))){V++,P(l,"Polling attempt "+V+"..."),await ee(G);continue}let Y=O(u,l);if(x&&E){let oe=l.skipCache;(!oe||!oe(Y,l))&&Ce(E,Y)}return Y}catch(I){let l=I;if(l.status=l?.status||u?.status||0,l.statusText=l?.statusText||u?.statusText||"",l.config=y,l.request=y,l.response=u,F===K||!(!ne||await ne(l,F))||!Te?.includes(l.status))return await p(l,y),v(y),g(l,u,y);P(d,`Attempt ${F+1} failed. Retry in ${B}ms.`),await ee(B),B*=Ee,B=Math.min(B,be),F++}return O(u,y)},O=(s,i,c=null)=>{let d=n(i,"defaultResponse");if(!s)return{ok:!1,error:c,data:d,headers:null,config:i};let u=s?.data;return(u==null||typeof u===C&&Object.keys(u).length===0)&&(u=d),n(i,"flattenResponse")&&(s.data=te(u)),s instanceof Response?{body:s.body,bodyUsed:s.bodyUsed,formData:s.formData,ok:s.ok,redirected:s.redirected,type:s.type,url:s.url,status:s.status,statusText:s.statusText,blob:s.blob.bind(s),json:s.json.bind(s),text:s.text.bind(s),clone:s.clone.bind(s),arrayBuffer:s.arrayBuffer.bind(s),error:c,data:u,headers:ye(s.headers),config:i}:s};return{getInstance:h,buildConfig:r,config:e,request:w}}function Qe(e){let t=e.endpoints,a=$(e);function n(){return a.getInstance()}function o(P){return console.error(`Add ${P} to 'endpoints'.`),Promise.resolve(null)}async function R(P,f={}){let r=t[P]||{url:P};return await a.request(r.url,{...r,...f})}let h={config:e,endpoints:t,requestHandler:a,getInstance:n,request:R};return new Proxy(h,{get(P,f){return f in h?h[f]:t[f]?h.request.bind(null,f):o.bind(null,f)}})}async function Ue(e,t={}){return $(t).request(e,t)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map