"use strict";var z=Object.defineProperty;var Ae=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var Be=Object.prototype.hasOwnProperty;var He=(e,t)=>{for(var r in t)z(e,r,{get:t[r],enumerable:!0})},Ue=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Ie(t))!Be.call(e,a)&&a!==r&&z(e,a,{get:()=>t[a],enumerable:!(n=Ae(t,a))||n.enumerable});return e};var Ne=e=>Ue(z({},"__esModule",{value:!0}),e);var Se={};He(Se,{createApiFetcher:()=>we,fetchf:()=>Z});module.exports=Ne(Se);async function D(e,t){if(t){if(typeof t=="function"){let r=await t(e);r&&Object.assign(e,r)}else if(Array.isArray(t))for(let r of t){let n=await r(e);n&&Object.assign(e,n)}}}var F=class extends Error{status;statusText;request;config;response;constructor(t,r,n){super(t),this.name="FetchError",this.message=t,this.status=n?.status||0,this.statusText=n?.statusText||"",this.request=r,this.config=r,this.response=n}};var A=class extends F{constructor(t,r,n){super(t,r,n),this.name="ResponseError"}};var I="application/",q=I+"json",ie="charset=utf-8",C="Content-Type",g="undefined",y="object",B="string",G="function",H="AbortError",ue="TimeoutError",le="CanceledError",T="GET",ce="HEAD";var pe=10,de=["__proto__","constructor","prototype"];function K(e){return e instanceof URLSearchParams}function U(e){return e!==null&&typeof e===y}function me(e){let t="";for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t+=r+":"+e[r]);return t}function V(e){if(!e||typeof e!==y||Array.isArray(e))return e;let t={...e};return de.forEach(r=>{delete t[r]}),t}function Y(e){let t={},r=Object.keys(e);r.sort();for(let n=0,a=r.length;n<a;n++){let c=r[n];de.includes(c)||(t[c]=e[c])}return t}function fe(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function Re(e,t){if(!t)return e;if(K(t)){let l=t.toString();return fe(e,l)}let r=[],n=encodeURIComponent,a=(l,s)=>{s=typeof s===G?s():s,s=s===null||s===void 0?"":s,r[r.length]=n(l)+"="+n(s)},c=(l,s,o=0)=>{if(o>=pe)return r;let i,d,m;if(l)if(Array.isArray(s))for(i=0,d=s.length;i<d;i++)c(l+"["+(typeof s[i]===y&&s[i]?i:"")+"]",s[i],o+1);else if(U(s))for(m in s)c(l+"["+m+"]",s[m],o+1);else a(l,s);else if(Array.isArray(s))for(i=0,d=s.length;i<d;i++)a(s[i].name,s[i].value);else for(m in s)c(m,s[m],o+1);return r},f=c("",t).join("&").replace(/%5B%5D/g,"[]");return fe(e,f)}function ye(e,t){if(!t||e.indexOf(":")===-1)return e;let r=t;return e.replace(/:([a-zA-Z0-9_]+)/g,(n,a)=>{if(Object.prototype.hasOwnProperty.call(r,a)){let c=r[a];if(c!=null)return encodeURIComponent(String(c))}return n})}function he(e){let t=typeof e;return t===g||e===null?!1:t===B||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==g&&typeof globalThis.Buffer!==g&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(U(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===G))}async function N(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function W(e,t=0){return t>=pe?e:e&&U(e)&&typeof e.data!==g&&Object.keys(e).length===1?W(e.data,t+1):e}function Pe(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((r,n)=>{t[n]=r});else if(U(e))for(let[r,n]of Object.entries(e))t[r.toLowerCase()]=n;return t}var b=new Map;async function ge(e,t,r=0,n=!1,a=!0){let c=Date.now(),p=b.get(e);if(p){let s=p[3],o=p[0],i=p[1];if(!s&&c-p[2]<r)return o;s&&o.abort(new DOMException("Aborted due to new request",H)),i!==null&&clearTimeout(i),b.delete(e)}let f=new AbortController,l=a?setTimeout(()=>{let s=new DOMException(`${e.url} aborted due to timeout`,ue);Q(e,s)},t):null;return b.set(e,[f,l,c,n]),f}async function Q(e,t=null){let r=b.get(e);if(r){let n=r[0],a=r[1];t&&!n.signal.aborted&&n.abort(t),a!==null&&clearTimeout(a),b.delete(e)}}async function De(e){if(!e?.body)return null;let t=e.headers?.get(C);t?t=t.toLowerCase().trim():t="";let r=t.split(";",1)[0],n;try{if(r.includes(q)||r.includes("+json"))n=await e.json();else if(r.includes("multipart/form-data"))n=await e.formData();else if(r.includes(I+"octet-stream"))n=await e.blob();else if(r.includes(I+"x-www-form-urlencoded"))n=await e.formData();else if(r.startsWith("text/"))n=await e.text();else try{n=await e.clone().json()}catch{n=await e.text()}}catch{n=null}return n}var _=(e,t,r=null)=>{let n=t.defaultResponse??null;if(!e)return{ok:!1,error:r,data:n,headers:null,config:t};let a=e?.data;return(a==null||typeof a===y&&Object.keys(a).length===0)&&(a=n),t.flattenResponse&&(e.data=W(a)),e instanceof Response?{body:e.body,bodyUsed:e.bodyUsed,ok:e.ok,redirected:e.redirected,type:e.type,url:e.url,status:e.status,statusText:e.statusText,blob:()=>e.blob(),json:()=>e.json(),text:()=>e.text(),clone:()=>e.clone(),arrayBuffer:()=>e.arrayBuffer(),formData:()=>e.formData(),bytes:()=>e.bytes(),error:r,data:a,headers:Pe(e.headers),config:t}:e};function S(e){let t=0;for(let r=0,n=e.length;r<n;r++){let a=e.charCodeAt(r);t=t*31+a|0}return String(t)}var X=new Map;function Ce(e){let{url:t="",method:r=T,headers:n={},body:a="",mode:c="cors",credentials:p="include",cache:f="default",redirect:l="follow",referrer:s="",integrity:o=""}=e;if(f==="reload")return"";let i=me(Y(n)),d="";if(a!==null)if(typeof a=="string")d=S(a);else if(a instanceof FormData)a.forEach((m,j)=>{d+=j+"="+m+"&"}),d=S(d);else if(typeof Blob!==g&&a instanceof Blob||typeof File!==g&&a instanceof File)d="BF"+a.size+a.type;else if(a instanceof ArrayBuffer||ArrayBuffer.isView(a))d="AB"+a.byteLength;else{let m=typeof a===y?Y(a):String(a);d=S(JSON.stringify(m))}return(r+t+c+p+f+l+s+o+i+d).replace(/[^\w-_]/g,"")}function Qe(e,t){return t?Date.now()-e>t*1e3:!1}function Te(e,t){let r=X.get(e);if(r){if(!Qe(r.timestamp,t))return r;X.delete(e)}return null}function Ee(e,t,r=!1){X.set(e,{data:t,isLoading:r,timestamp:Date.now()})}var k={method:T,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:q+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}},qe=(e,t)=>{let r=(t.method??T).toUpperCase(),n=r===T||r===ce,a=ye(e,t.urlPathParams),c;n||(c=t.body??t.data);let p=t.headers;_e(r,p,c);let f=t.withCredentials?"include":t.credentials,l=t.params,s=l?Re(a,l):a,i=s.includes("://")?"":t.baseURL??t.apiUrl;return c&&typeof c!==B&&!K(c)&&he(c)&&(c=JSON.stringify(c)),{...t,url:i+s,method:r,credentials:f,body:c}},_e=(e,t,r)=>{if(!r&&["PUT","DELETE"].includes(e))return;let n=q+";"+ie;t instanceof Headers?t.has(C)||t.set(C,n):typeof t===y&&!Array.isArray(t)&&!t[C]&&(t[C]=n)},w=(e,t,r,n)=>{n[e]&&(t[e]={...r[e],...n[e]})};function L(e){let t=e?V(e):{},r={...k,...t};w("retry",r,k,t),w("headers",r,k,t);let n=t.fetcher?.create?.(r);return{getInstance:()=>n||null,config:r,request:async(p,f=null)=>{let l=f?V(f):{},s={...r,...l};w("retry",s,r,l),w("headers",s,r,l);let o=null,i=qe(p,s),{timeout:d,cancellable:m,dedupeTime:j,pollingInterval:ee,shouldStopPolling:te,cacheTime:$,cacheKey:re}=s,E=null;if($&&(E=re?re(i):Ce(i),E&&!s.cacheBuster?.(i))){let u=Te(E,$);if(u)return u.data}let{retries:x=0,delay:xe,backoff:ne,retryOn:Oe,shouldRetry:O,maxDelay:ae,resetTimeout:Fe}=s.retry,h=0,v=0,R=xe,se=x>0?x:0;for(;h<=se;)try{let u={signal:(await ge(i,d,j,m,!!(d&&(!se||Fe)))).signal,...i};if(await D(u,l.onRequest),await D(u,r.onRequest),o=n?.request?await n.request(u):await fetch(u.url,u),o instanceof Response&&(o.config=u,o.data=await De(o),!o.ok))throw new A(`${u.method} to ${u.url} failed! Status: ${o.status||null}`,u,o);await D(o,l.onResponse),await D(o,r.onResponse),Q(i);let P=_(o,u);if(O&&h<x&&await O(P,h)){M(s,`Attempt ${h+1} failed response data check. Retry in ${R}ms.`),await N(R),R*=ne,R=Math.min(R,ae),h++;continue}if(ee&&(!te||!te(P,v))){v++,M(s,"Polling attempt "+v+"..."),await N(ee);continue}return $&&E&&u.skipCache&&!u.skipCache(P,u)&&Ee(E,P),P}catch(J){let u=J;u.status=u?.status||o?.status||0,u.statusText=u?.statusText||o?.statusText||"",u.config=i,u.request=i,u.response=o;let P=_(o,i,u);if(h===x||!Oe?.includes(u.status)||!O||!await O(P,h)){if(be(u)||M(s,"FETCH ERROR",u),await D(u,l.onError),await D(u,r.onError),Q(i),!be(u)||s.rejectCancelled){let oe=s.strategy;if(oe==="reject")return Promise.reject(u);oe==="silent"&&await new Promise(()=>null)}return P}M(s,`Attempt ${h+1} failed. Retry in ${R}ms.`),await N(R),R*=ne,R=Math.min(R,ae),h++}return _(o,i)}}}var be=e=>e.name===H||e.name===le,M=(e,...t)=>{let r=e.logger;r&&r.warn&&r.warn(...t)};function we(e){let t=e.endpoints,r=L(e);function n(){return r.getInstance()}function a(f){return console.error(`Add ${f} to 'endpoints'.`),Promise.resolve(null)}async function c(f,l={}){let s=t[f]||{url:String(f)},o=s.url;if(o.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");return o.includes("://")?await Z(o,l):await r.request(o,{...s,...l})}let p={config:e,endpoints:t,requestHandler:r,getInstance:n,request:c};return new Proxy(p,{get(f,l){return l in p?p[l]:t[l]?p.request.bind(null,l):a.bind(null,l)}})}async function Z(e,t={}){return L(t).request(e)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map