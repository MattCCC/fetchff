"use strict";var G=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var He=Object.getOwnPropertyNames;var Ue=Object.prototype.hasOwnProperty;var Ne=(e,t)=>{for(var r in t)G(e,r,{get:t[r],enumerable:!0})},Qe=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of He(t))!Ue.call(e,s)&&s!==r&&G(e,s,{get:()=>t[s],enumerable:!(n=Be(t,s))||n.enumerable});return e};var _e=e=>Qe(G({},"__esModule",{value:!0}),e);var ke={};Ne(ke,{createApiFetcher:()=>we,fetchf:()=>ee});module.exports=_e(ke);async function D(e,t){if(t){if(typeof t=="function"){let r=await t(e);r&&Object.assign(e,r)}else if(Array.isArray(t))for(let r of t){let n=await r(e);n&&Object.assign(e,n)}}}var A=class extends Error{status;statusText;request;config;response;constructor(t,r,n){super(t),this.name="FetchError",this.message=t,this.status=n?.status||0,this.statusText=n?.statusText||"",this.request=r,this.config=r,this.response=n}};var F=class extends A{constructor(t,r,n){super(t,r,n),this.name="ResponseError"}};var I="application/",q=I+"json",ue="charset=utf-8",C="Content-Type",g="undefined",y="object",B="string",K="function",H="AbortError",le="TimeoutError",ce="CanceledError",T="GET",fe="HEAD";var de=10,me=["__proto__","constructor","prototype"];function V(e){return e instanceof URLSearchParams}function U(e){return e!==null&&typeof e===y}function Re(e){let t="";for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t+=r+":"+e[r]);return t}function Y(e){if(!e||typeof e!==y||Array.isArray(e))return e;let t={...e};return me.forEach(r=>{delete t[r]}),t}function W(e){let t={},r=Object.keys(e);r.sort();for(let n=0,s=r.length;n<s;n++){let l=r[n];me.includes(l)||(t[l]=e[l])}return t}function pe(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function ye(e,t){if(!t)return e;if(V(t)){let u=t.toString();return pe(e,u)}let r=[],n=encodeURIComponent,s=(u,a)=>{a=typeof a===K?a():a,a=a===null||a===void 0?"":a,r[r.length]=n(u)+"="+n(a)},l=(u,a,o=0)=>{if(o>=de)return r;let c,d,m;if(u)if(Array.isArray(a))for(c=0,d=a.length;c<d;c++)l(u+"["+(typeof a[c]===y&&a[c]?c:"")+"]",a[c],o+1);else if(U(a))for(m in a)l(u+"["+m+"]",a[m],o+1);else s(u,a);else if(Array.isArray(a))for(c=0,d=a.length;c<d;c++)s(a[c].name,a[c].value);else for(m in a)l(m,a[m],o+1);return r},f=l("",t).join("&").replace(/%5B%5D/g,"[]");return pe(e,f)}function he(e,t){if(!t||e.indexOf(":")===-1)return e;let r=t;return e.replace(/:([a-zA-Z0-9_]+)/g,(n,s)=>{if(Object.prototype.hasOwnProperty.call(r,s)){let l=r[s];if(l!=null)return encodeURIComponent(String(l))}return n})}function Pe(e){let t=typeof e;return t===g||e===null?!1:t===B||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==g&&typeof globalThis.Buffer!==g&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(U(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===K))}async function N(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function X(e,t=0){return t>=de?e:e&&U(e)&&typeof e.data!==g&&Object.keys(e).length===1?X(e.data,t+1):e}function ge(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((r,n)=>{t[n]=r});else if(U(e))for(let[r,n]of Object.entries(e))t[r.toLowerCase()]=n;return t}var b=new Map;async function De(e,t,r=0,n=!1,s=!0){let l=Date.now(),p=b.get(e);if(p){let a=p[3],o=p[0],c=p[1];if(!a&&l-p[2]<r)return o;a&&o.abort(new DOMException("Aborted due to new request",H)),c!==null&&clearTimeout(c),b.delete(e)}let f=new AbortController,u=s?setTimeout(()=>{let a=new DOMException(`${e.url} aborted due to timeout`,le);Q(e,a)},t):null;return b.set(e,[f,u,l,n]),f}async function Q(e,t=null){let r=b.get(e);if(r){let n=r[0],s=r[1];t&&!n.signal.aborted&&n.abort(t),s!==null&&clearTimeout(s),b.delete(e)}}async function Ce(e){if(!e?.body)return null;let t=e.headers?.get(C);t?t=t.toLowerCase().trim():t="";let r=t.split(";",1)[0],n;try{if(r.includes(q)||r.includes("+json"))n=await e.json();else if(r.includes("multipart/form-data"))n=await e.formData();else if(r.includes(I+"octet-stream"))n=await e.blob();else if(r.includes(I+"x-www-form-urlencoded"))n=await e.formData();else if(r.startsWith("text/"))n=await e.text();else try{n=await e.clone().json()}catch{n=await e.text()}}catch{n=null}return n}var _=(e,t,r=null)=>{let n=t.defaultResponse??null;if(!e)return{ok:!1,error:r,data:n,headers:null,config:t};let s=e?.data;return(s==null||typeof s===y&&Object.keys(s).length===0)&&(s=n),t.flattenResponse&&(e.data=X(s)),e instanceof Response?{body:e.body,bodyUsed:e.bodyUsed,ok:e.ok,redirected:e.redirected,type:e.type,url:e.url,status:e.status,statusText:e.statusText,blob:()=>e.blob(),json:()=>e.json(),text:()=>e.text(),clone:()=>e.clone(),arrayBuffer:()=>e.arrayBuffer(),formData:()=>e.formData(),bytes:()=>e.bytes(),error:r,data:s,headers:ge(e.headers),config:t}:e};function S(e){let t=0;for(let r=0,n=e.length;r<n;r++){let s=e.charCodeAt(r);t=t*31+s|0}return String(t)}var Z=new Map;function Te(e){let{url:t="",method:r=T,headers:n={},body:s="",mode:l="cors",credentials:p="include",cache:f="default",redirect:u="follow",referrer:a="",integrity:o=""}=e;if(f==="reload")return"";let c=Re(W(n)),d="";if(s!==null)if(typeof s=="string")d=S(s);else if(s instanceof FormData)s.forEach((m,j)=>{d+=j+"="+m+"&"}),d=S(d);else if(typeof Blob!==g&&s instanceof Blob||typeof File!==g&&s instanceof File)d="BF"+s.size+s.type;else if(s instanceof ArrayBuffer||ArrayBuffer.isView(s))d="AB"+s.byteLength;else{let m=typeof s===y?W(s):String(s);d=S(JSON.stringify(m))}return(r+t+l+p+f+u+a+o+c+d).replace(/[^\w-_]/g,"")}function Se(e,t){return t?Date.now()-e>t*1e3:!1}function Ee(e,t){let r=Z.get(e);if(r){if(!Se(r.timestamp,t))return r;Z.delete(e)}return null}function qe(e,t,r=!1){Z.set(e,{data:t,isLoading:r,timestamp:Date.now()})}var M={method:T,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:q+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}},be=(e,t)=>{let r=(t.method??T).toUpperCase(),n=r===T||r===fe,s=he(e,t.urlPathParams),l;n||(l=t.body??t.data),Me(r,t.headers,l);let p=t.withCredentials?"include":t.credentials,f=t.params,u=f?ye(s,f):s,o=u.includes("://")?"":t.baseURL??t.apiUrl;return l&&typeof l!==B&&!V(l)&&Pe(l)&&(l=JSON.stringify(l)),{...t,url:o+u,method:r,credentials:p,body:l}},Me=(e,t,r)=>{if(!t||!r&&["PUT","DELETE"].includes(e))return;let n=q+";"+ue;t instanceof Headers?t.has(C)||t.set(C,n):typeof t===y&&!Array.isArray(t)&&!t[C]&&(t[C]=n)},x=(e,t,r,n)=>{n[e]&&(t[e]={...r[e],...n[e]})};function xe(e){let t=e?.headers?.["retry-after"];if(!t)return null;let r=Number(t);if(!isNaN(r)&&r>=0)return r*1e3;let n=new Date(t);if(!isNaN(n.getTime())){let s=n.getTime()-Date.now();return s>0?s:0}return null}function L(e){let t=e?Y(e):{},r={...M,...t};x("retry",r,M,t),x("headers",r,M,t);let n=t.fetcher?.create?.(r);return{getInstance:()=>n||null,config:r,request:async(p,f=null)=>{let u=f?Y(f):{},a={...r,...u};x("retry",a,r,u),x("headers",a,r,u);let o=null,c=be(p,a),{timeout:d,cancellable:m,dedupeTime:j,pollingInterval:te,shouldStopPolling:re,cacheTime:v,cacheKey:ne}=a,E=null;if(v&&(E=ne?ne(c):Te(c),E&&!a.cacheBuster?.(c))){let i=Ee(E,v);if(i)return i.data}let{retries:O=0,delay:Ae,backoff:se,retryOn:Fe,shouldRetry:w,maxDelay:ae,resetTimeout:Ie}=a.retry,h=0,$=0,R=Ae,oe=O>0?O:0;for(;h<=oe;)try{let i={signal:(await De(c,d,j,m,!!(d&&(!oe||Ie)))).signal,...c};if(await D(i,u.onRequest),await D(i,r.onRequest),o=n?.request?await n.request(i):await fetch(i.url,i),o instanceof Response&&(o.config=i,o.data=await Ce(o),!o.ok))throw new F(`${i.method} to ${i.url} failed! Status: ${o.status||null}`,i,o);await D(o,u.onResponse),await D(o,r.onResponse),Q(c);let P=_(o,i);if(w&&h<O&&await w(P,h)){k(a,`Attempt ${h+1} failed response data check. Retry in ${R}ms.`),await N(R),R*=se,R=Math.min(R,ae),h++;continue}if(te&&(!re||!re(P,$))){$++,k(a,"Polling attempt "+$+"..."),await N(te);continue}return v&&E&&i.skipCache&&!i.skipCache(P,i)&&qe(E,P),P}catch(J){let i=J;i.status=i?.status||o?.status||0,i.statusText=i?.statusText||o?.statusText||"",i.config=c,i.request=c,i.response=o;let P=_(o,c,i);if(h===O||!Fe?.includes(i.status)||!w||!await w(P,h)){if(Oe(i)||k(a,"FETCH ERROR",i),await D(i,u.onError),await D(i,r.onError),Q(c),!Oe(i)||a.rejectCancelled){let ie=a.strategy;if(ie==="reject")return Promise.reject(i);ie==="silent"&&await new Promise(()=>null)}return P}if(i.status===429){let z=xe(P);z!==null&&(R=z)}k(a,`Attempt ${h+1} failed. Retry in ${R}ms.`),await N(R),R*=se,R=Math.min(R,ae),h++}return _(o,c)}}}var Oe=e=>e.name===H||e.name===ce,k=(e,...t)=>{let r=e.logger;r&&r.warn&&r.warn(...t)};function we(e){let t=e.endpoints,r=L(e);function n(){return r.getInstance()}function s(f){return console.error(`Add ${f} to 'endpoints'.`),Promise.resolve(null)}async function l(f,u={}){let a=t[f]||{url:String(f)},o=a.url;if(o.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");return o.includes("://")?await ee(o,u):await r.request(o,{...a,...u})}let p={config:e,endpoints:t,requestHandler:r,getInstance:n,request:l};return new Proxy(p,{get(f,u){return u in p?p[u]:t[u]?p.request.bind(null,u):s.bind(null,u)}})}async function ee(e,t={}){return L(t).request(e)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map