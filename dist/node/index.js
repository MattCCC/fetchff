"use strict";var z=Object.defineProperty;var Ae=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var Be=Object.prototype.hasOwnProperty;var He=(e,t)=>{for(var r in t)z(e,r,{get:t[r],enumerable:!0})},Ue=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Ie(t))!Be.call(e,a)&&a!==r&&z(e,a,{get:()=>t[a],enumerable:!(s=Ae(t,a))||s.enumerable});return e};var Qe=e=>Ue(z({},"__esModule",{value:!0}),e);var Se={};He(Se,{createApiFetcher:()=>be,fetchf:()=>Z});module.exports=Qe(Se);async function g(e,t){if(t){if(typeof t=="function"){let r=await t(e);r&&Object.assign(e,r)}else if(Array.isArray(t))for(let r of t){let s=await r(e);s&&Object.assign(e,s)}}}var w=class extends Error{status;statusText;request;config;response;constructor(t,r,s){super(t),this.name="FetchError",this.message=t,this.status=s?.status||0,this.statusText=s?.statusText||"",this.request=r,this.config=r,this.response=s}};var F=class extends w{constructor(t,r,s){super(t,r,s),this.name="ResponseError"}};var A="application/",T=A+"json",oe="charset=utf-8",D="Content-Type",h="undefined",y="object",I="string",G="function",B="AbortError",ie="TimeoutError",ue="CanceledError",C="GET",le="HEAD";var fe=10,pe=["__proto__","constructor","prototype"];function K(e){return e instanceof URLSearchParams}function H(e){return e!==null&&typeof e===y}function de(e){let t="";for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t+=r+":"+e[r]);return t}function V(e){if(!e||typeof e!==y||Array.isArray(e))return e;let t={...e};return pe.forEach(r=>{delete t[r]}),t}function Y(e){let t={},r=Object.keys(e);r.sort();for(let s=0,a=r.length;s<a;s++){let i=r[s];pe.includes(i)||(t[i]=e[i])}return t}function ce(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function me(e,t){if(!t)return e;if(K(t)){let c=t.toString();return ce(e,c)}let r=[],s=encodeURIComponent,a=(c,n)=>{n=typeof n===G?n():n,n=n===null||n===void 0?"":n,r[r.length]=s(c)+"="+s(n)},i=(c,n,f=0)=>{if(f>=fe)return r;let o,u,m;if(c)if(Array.isArray(n))for(o=0,u=n.length;o<u;o++)i(c+"["+(typeof n[o]===y&&n[o]?o:"")+"]",n[o],f+1);else if(H(n))for(m in n)i(c+"["+m+"]",n[m],f+1);else a(c,n);else if(Array.isArray(n))for(o=0,u=n.length;o<u;o++)a(n[o].name,n[o].value);else for(m in n)i(m,n[m],f+1);return r},p=i("",t).join("&").replace(/%5B%5D/g,"[]");return ce(e,p)}function Re(e,t){if(!t||e.indexOf(":")===-1)return e;let r=t;return e.replace(/:([a-zA-Z0-9_]+)/g,(s,a)=>{if(Object.prototype.hasOwnProperty.call(r,a)){let i=r[a];if(i!=null)return encodeURIComponent(String(i))}return s})}function ye(e){let t=typeof e;return t===h||e===null?!1:t===I||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==h&&typeof globalThis.Buffer!==h&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(H(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===G))}async function U(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function W(e,t=0){return t>=fe?e:e&&H(e)&&typeof e.data!==h&&Object.keys(e).length===1?W(e.data,t+1):e}function Pe(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((r,s)=>{t[s]=r});else if(H(e))for(let[r,s]of Object.entries(e))t[r.toLowerCase()]=s;return t}var q=new Map;async function he(e,t,r=0,s=!1,a=!0){let i=Date.now(),d=q.get(e);if(d){let n=d[3],f=d[0],o=d[1];if(!n&&i-d[2]<r)return f;n&&f.abort(new DOMException("Aborted due to new request",B)),o!==null&&clearTimeout(o),q.delete(e)}let p=new AbortController,c=a?setTimeout(()=>{let n=new DOMException(`${e.url} aborted due to timeout`,ie);Q(e,n)},t):null;return q.set(e,[p,c,i,s]),p}async function Q(e,t=null){let r=q.get(e);if(r){let s=r[0],a=r[1];t&&!s.signal.aborted&&s.abort(t),a!==null&&clearTimeout(a),q.delete(e)}}async function ge(e){if(!e?.body)return null;let t=e.headers?.get(D);t?t=t.toLowerCase().trim():t="";let r=t.split(";",1)[0],s;try{if(r.includes(T)||r.includes("+json"))s=await e.json();else if(r.includes("multipart/form-data"))s=await e.formData();else if(r.includes(A+"octet-stream"))s=await e.blob();else if(r.includes(A+"x-www-form-urlencoded"))s=await e.formData();else if(r.startsWith("text/"))s=await e.text();else try{s=await e.clone().json()}catch{s=await e.text()}}catch{s=null}return s}var N=(e,t,r=null)=>{let s=t.defaultResponse??null;if(!e)return{ok:!1,error:r,data:s,headers:null,config:t};let a=e?.data;return(a==null||typeof a===y&&Object.keys(a).length===0)&&(a=s),t.flattenResponse&&(e.data=W(a)),e instanceof Response?{body:e.body,bodyUsed:e.bodyUsed,ok:e.ok,redirected:e.redirected,type:e.type,url:e.url,status:e.status,statusText:e.statusText,blob:()=>e.blob(),json:()=>e.json(),text:()=>e.text(),clone:()=>e.clone(),arrayBuffer:()=>e.arrayBuffer(),formData:()=>e.formData(),bytes:()=>e.bytes(),error:r,data:a,headers:Pe(e.headers),config:t}:e};function _(e){let t=0;for(let r=0,s=e.length;r<s;r++){let a=e.charCodeAt(r);t=t*31+a|0}return String(t)}var X=new Map;function De(e){let{url:t="",method:r=C,headers:s={},body:a="",mode:i="cors",credentials:d="include",cache:p="default",redirect:c="follow",referrer:n="",integrity:f=""}=e;if(p==="reload")return"";let o=de(Y(s)),u="";if(a!==null)if(typeof a=="string")u=_(a);else if(a instanceof FormData)a.forEach((m,L)=>{u+=L+"="+m+"&"}),u=_(u);else if(typeof Blob!==h&&a instanceof Blob||typeof File!==h&&a instanceof File)u="BF"+a.size+a.type;else if(a instanceof ArrayBuffer||ArrayBuffer.isView(a))u="AB"+a.byteLength;else{let m=typeof a===y?Y(a):String(a);u=_(JSON.stringify(m))}return(r+t+i+d+p+c+n+f+o+u).replace(/[^\w-_]/g,"")}function Ne(e,t){return t?Date.now()-e>t*1e3:!1}function Ce(e,t){let r=X.get(e);if(r){if(!Ne(r.timestamp,t))return r;X.delete(e)}return null}function Ee(e,t,r=!1){X.set(e,{data:t,isLoading:r,timestamp:Date.now()})}var S={method:C,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:T+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}},Te=(e,t)=>{let r=(t.method??C).toUpperCase(),s=r===C||r===le,a=Re(e,t.urlPathParams),i;s||(i=t.body??t.data);let d=t.headers;_e(r,d,i);let p=t.withCredentials?"include":t.credentials,c=t.params,n=c?me(a,c):a,o=n.includes("://")?"":t.baseURL??t.apiUrl;return i&&typeof i!==I&&!K(i)&&ye(i)&&(i=JSON.stringify(i)),{...t,url:o+n,method:r,credentials:p,body:i}},_e=(e,t,r)=>{if(!r&&["PUT","DELETE"].includes(e))return;let s=T+";"+oe;t instanceof Headers?t.has(D)||t.set(D,s):typeof t===y&&!Array.isArray(t)&&!t[D]&&(t[D]=s)},b=(e,t,r,s)=>{s[e]&&(t[e]={...r[e],...s[e]})};function k(e){let t=e?V(e):{},r={...S,...t};b("retry",r,S,t),b("headers",r,S,t);let s=t.fetcher?.create?.(r),a=()=>s||null,i=async(p,c,n)=>{if(!qe(p)||n.rejectCancelled){let u=n.strategy;if(u==="reject")return Promise.reject(p);u==="silent"&&await new Promise(()=>null)}return N(c,n,p)};return{getInstance:a,config:r,request:async(p,c=null)=>{let n=c?V(c):{},f={...r,...n};b("retry",f,r,n),b("headers",f,r,n);let o=null,u=Te(p,f),{timeout:m,cancellable:L,dedupeTime:xe,pollingInterval:ee,shouldStopPolling:te,cacheTime:j,cacheKey:re}=f,E=null;if(j&&(E=re?re(u):De(u),E&&!f.cacheBuster?.(u))){let l=Ce(E,j);if(l)return l.data}let{retries:x=0,delay:Oe,backoff:se,retryOn:we,shouldRetry:O,maxDelay:ae,resetTimeout:Fe}=f.retry,P=0,$=0,R=Oe,ne=x>0?x:0;for(;P<=ne;)try{let l={signal:(await he(u,m,xe,L,!!(m&&(!ne||Fe)))).signal,...u};if(await g(l,n.onRequest),await g(l,r.onRequest),o=s?.request?await s.request(l):await fetch(l.url,l),o instanceof Response&&(o.config=l,o.data=await ge(o),!o.ok))throw new F(`${l.method} to ${l.url} failed! Status: ${o.status||null}`,l,o);if(await g(o,n.onResponse),await g(o,r.onResponse),Q(u),O&&P<x&&await O({config:u,request:u,response:o},P)){M(f,`Attempt ${P+1} failed response data check. Retry in ${R}ms.`),await U(R),R*=se,R=Math.min(R,ae),P++;continue}if(ee&&(!te||!te(o,$))){$++,M(f,"Polling attempt "+$+"..."),await U(ee);continue}let J=N(o,l);return j&&E&&l.skipCache&&!l.skipCache(J,l)&&Ee(E,J),J}catch(v){let l=v;if(l.status=l?.status||o?.status||0,l.statusText=l?.statusText||o?.statusText||"",l.config=u,l.request=u,l.response=o,P===x||!we?.includes(l.status)||!O||!await O(l,P))return qe(l)||M(f,"API ERROR",l),await g(l,n.onError),await g(l,r.onError),Q(u),i(l,o,u);M(f,`Attempt ${P+1} failed. Retry in ${R}ms.`),await U(R),R*=se,R=Math.min(R,ae),P++}return N(o,u)}}}var qe=e=>e.name===B||e.name===ue,M=(e,...t)=>{let r=e.logger;r&&r.warn&&r.warn(...t)};function be(e){let t=e.endpoints,r=k(e);function s(){return r.getInstance()}function a(p){return console.error(`Add ${p} to 'endpoints'.`),Promise.resolve(null)}async function i(p,c={}){let n=t[p]||{url:String(p)},f=n.url;if(f.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");return f.includes("://")?await Z(f,c):await r.request(f,{...n,...c})}let d={config:e,endpoints:t,requestHandler:r,getInstance:s,request:i};return new Proxy(d,{get(p,c){return c in d?d[c]:t[c]?d.request.bind(null,c):a.bind(null,c)}})}async function Z(e,t={}){return k(t).request(e)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map