"use strict";var ee=Object.defineProperty;var He=Object.getOwnPropertyDescriptor;var Qe=Object.getOwnPropertyNames;var Ne=Object.prototype.hasOwnProperty;var _e=(e,t)=>{for(var s in t)ee(e,s,{get:t[s],enumerable:!0})},Se=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Qe(t))!Ne.call(e,n)&&n!==s&&ee(e,n,{get:()=>t[n],enumerable:!(r=He(t,n))||r.enumerable});return e};var ke=e=>Se(ee({},"__esModule",{value:!0}),e);var je={};_e(je,{createApiFetcher:()=>Le,fetchf:()=>ue});module.exports=ke(je);async function b(e,t){if(t){if(typeof t=="function"){let s=await t(e);s&&Object.assign(e,s)}else if(Array.isArray(t))for(let s of t){let r=await s(e);r&&Object.assign(e,r)}}}var S=class extends Error{status;statusText;request;config;response;constructor(t,s,r){super(t),this.name="FetchError",this.message=t,this.status=r?.status||0,this.statusText=r?.statusText||"",this.request=s,this.config=s,this.response=r}};var k=class extends S{constructor(t,s,r){super(t,s,r),this.name="ResponseError"}};var M="application/",B=M+"json",pe="charset=utf-8",w="Content-Type",T="undefined",E="object",L="string",A="function",j="AbortError",de="TimeoutError",Re="CanceledError",U="GET",me="HEAD";var Pe=10,he=["__proto__","constructor","prototype"];function te(e){return e instanceof URLSearchParams}function v(e){return e!==null&&typeof e===E}function ge(e){let t="";for(let s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t+=s+":"+e[s]);return t}function se(e){if(!e||typeof e!==E||Array.isArray(e))return e;let t={...e};return he.forEach(s=>{delete t[s]}),t}function ae(e){let t={},s=Object.keys(e);s.sort();for(let r=0,n=s.length;r<n;r++){let R=s[r];he.includes(R)||(t[R]=e[R])}return t}function ye(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function De(e,t){if(!t)return e;if(te(t)){let c=t.toString();return ye(e,c)}let s=[],r=encodeURIComponent,n=(c,o)=>{o=typeof o===A?o():o,o=o===null||o===void 0?"":o,s[s.length]=r(c)+"="+r(o)},R=(c,o,P=0)=>{if(P>=Pe)return s;let p,h,D;if(c)if(Array.isArray(o))for(p=0,h=o.length;p<h;p++)R(c+"["+(typeof o[p]===E&&o[p]?p:"")+"]",o[p],P+1);else if(v(o))for(D in o)R(c+"["+D+"]",o[D],P+1);else n(c,o);else if(Array.isArray(o))for(p=0,h=o.length;p<h;p++)n(o[p].name,o[p].value);else for(D in o)R(D,o[D],P+1);return s},g=R("",t).join("&").replace(/%5B%5D/g,"[]");return ye(e,g)}function Ce(e,t){return t?e.replace(/:\w+/g,s=>{let r=s.substring(1);return t[r]?encodeURIComponent(String(t[r])):s}):e}function Te(e){let t=typeof e;return t===T||e===null?!1:t===L||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==T&&typeof globalThis.Buffer!==T&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(v(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===A))}async function ne(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function re(e,t=0){return t>=Pe?e:e&&v(e)&&typeof e.data!==T&&Object.keys(e).length===1?re(e.data,t+1):e}function Ee(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((s,r)=>{t[r]=s});else if(v(e))for(let[s,r]of Object.entries(e))t[s.toLowerCase()]=r;return t}var H=new Map;async function qe(e,t,s=0,r=!1,n=!0){let R=Date.now(),m=H.get(e);if(m){let o=m[3],P=m[0],p=m[1];if(!o&&R-m[2]<s)return P;o&&P.abort(new DOMException("Aborted due to new request",j)),p!==null&&clearTimeout(p),H.delete(e)}let g=new AbortController,c=n?setTimeout(()=>{let o=new DOMException(`${e.url} aborted due to timeout`,de);J(e,o)},t):null;return H.set(e,[g,c,R,r]),g}async function J(e,t=null){let s=H.get(e);if(s){let r=s[0],n=s[1];t&&!r.signal.aborted&&r.abort(t),n!==null&&clearTimeout(n),H.delete(e)}}async function be(e){if(!e?.body)return null;let t=String(e.headers?.get(w)||"").split(";")[0],s;try{if(t.includes(B)||t.includes("+json"))s=await e.json();else if(t.includes("multipart/form-data"))s=await e.formData();else if(t.includes(M+"octet-stream"))s=await e.blob();else if(t.includes(M+"x-www-form-urlencoded"))s=await e.formData();else if(t.includes("text/"))s=await e.text();else try{s=await e.clone().json()}catch{s=await e.text()}}catch{s=null}return s}function $(e){let t=0;for(let s=0,r=e.length;s<r;s++){let n=e.charCodeAt(s);t=t*31+n|0}return String(t)}var oe=new Map;function we(e){let{url:t="",method:s=U,headers:r={},body:n="",mode:R="cors",credentials:m="include",cache:g="default",redirect:c="follow",referrer:o="",integrity:P=""}=e;if(g==="reload")return"";let p=ge(ae(r)),h="";if(n!==null)if(typeof n=="string")h=$(n);else if(n instanceof FormData)n.forEach((D,G)=>{h+=G+"="+D+"&"}),h=$(h);else if(typeof Blob!==T&&n instanceof Blob||typeof File!==T&&n instanceof File)h="BF"+n.size+n.type;else if(n instanceof ArrayBuffer||ArrayBuffer.isView(n))h="AB"+n.byteLength;else{let D=typeof n===E?ae(n):String(n);h=$(JSON.stringify(D))}return(s+t+R+m+g+c+o+P+p+h).replace(/[^\w-_]/g,"")}function Me(e,t){return t?Date.now()-e>t*1e3:!1}function Oe(e,t){let s=oe.get(e);if(s){if(!Me(s.timestamp,t))return s;oe.delete(e)}return null}function xe(e,t,s=!1){oe.set(e,{data:t,isLoading:s,timestamp:Date.now()})}var ie={method:U,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:B+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function z(e){let t=se(e),s={...ie,...t},r=(a,i,f,d)=>{d[a]&&(i[a]={...f[a],...d[a]})};r("retry",s,ie,t),r("headers",s,ie,t);let n=(a,i)=>typeof a[i]!==T?a[i]:s[i],R=n(t,"fetcher"),m=R?.create(s)||null,g=()=>m,c=(a,...i)=>{let f=n(a,"logger");f?.warn&&f.warn(...i)},o=(a,i,f)=>{if(!f&&["PUT","DELETE"].includes(i))return;let d=B+";"+pe;a instanceof Headers?a.has(w)||a.set(w,d):typeof a===E&&!Array.isArray(a)&&!a[w]&&(a[w]=d)},P=(a,i)=>{let f=n(i,"method").toUpperCase(),d=f===U||f===me,u=Ce(a,n(i,"urlPathParams")),y=n(i,"params"),Q=n(i,"body")||n(i,"data"),C;d||(C=Q);let N=n(i,"headers");o(N,f,C);let _=n(i,"withCredentials")?"include":n(i,"credentials"),O=y?De(u,y):u,q=O.includes("://")?"":n(i,"baseURL")||n(i,"apiUrl");return C&&typeof C!==L&&!te(C)&&Te(C)&&(C=JSON.stringify(C)),{...i,credentials:_,body:C,method:f,headers:N,url:q+O}},p=async(a,i)=>{D(a)||c(i,"API ERROR",a),await b(a,i?.onError),await b(a,s?.onError)},h=async(a,i,f)=>{let d=D(a),u=n(f,"strategy"),y=n(f,"rejectCancelled");if(!(d&&!y)){if(u==="silent")await new Promise(()=>null);else if(u==="reject")return Promise.reject(a)}return K(i,f,a)},D=a=>a.name===j||a.name===Re,G=async(a,i=null)=>{let f=se(i||{}),d={...s,...f};r("retry",d,s,f),r("headers",d,s,f);let u=null,y=P(a,d),{timeout:Q,cancellable:C,dedupeTime:N,pollingInterval:V,shouldStopPolling:_,cacheTime:O,cacheKey:Y}=d,q;if(Y?q=Y(y):q=we(y),O&&q){let I=d.cacheBuster;if(!I||!I(y)){let l=Oe(q,O);if(l)return l.data}}let{retries:W=0,delay:Fe,backoff:Ie,retryOn:Be,shouldRetry:le,maxDelay:Ae,resetTimeout:Ue}=d.retry,x=0,X=0,F=Fe,ce=W>0?W:0;for(;x<=ce;)try{let l={signal:(await qe(y,Q,N,C,!!(Q&&(!ce||Ue)))).signal,...y};if(await b(l,f?.onRequest),await b(l,s?.onRequest),R!==null&&m!==null&&typeof m.request===A?u=await m.request(l):u=await fetch(l.url,l),u instanceof Response&&(u.config=l,u.data=await be(u),!u.ok))throw new k(`${l.url} failed! Status: ${u.status||null}`,l,u);if(await b(u,f?.onResponse),await b(u,s?.onResponse),J(y),V&&(!_||!_(u,X))){X++,c(l,"Polling attempt "+X+"..."),await ne(V);continue}let Z=K(u,l);if(O&&q){let fe=l.skipCache;(!fe||!fe(Z,l))&&xe(q,Z)}return Z}catch(I){let l=I;if(l.status=l?.status||u?.status||0,l.statusText=l?.statusText||u?.statusText||"",l.config=y,l.request=y,l.response=u,x===W||!(!le||await le(l,x))||!Be?.includes(l.status))return await p(l,y),J(y),h(l,u,y);c(d,`Attempt ${x+1} failed. Retry in ${F}ms.`),await ne(F),F*=Ie,F=Math.min(F,Ae),x++}return K(u,y)},K=(a,i,f=null)=>{let d=n(i,"defaultResponse");if(!a)return{ok:!1,error:f,data:d,headers:null,config:i};let u=a?.data;return(u==null||typeof u===E&&Object.keys(u).length===0)&&(u=d),n(i,"flattenResponse")&&(a.data=re(u)),a instanceof Response?{body:a.body,bodyUsed:a.bodyUsed,ok:a.ok,redirected:a.redirected,type:a.type,url:a.url,status:a.status,statusText:a.statusText,blob:()=>a.blob(),json:()=>a.json(),text:()=>a.text(),clone:()=>a.clone(),arrayBuffer:()=>a.arrayBuffer(),formData:()=>a.formData(),bytes:()=>a.bytes(),error:f,data:u,headers:Ee(a.headers),config:i}:a};return{getInstance:g,buildConfig:P,config:s,request:G}}function Le(e){let t=e.endpoints,s=z(e);function r(){return s.getInstance()}function n(g){return console.error(`Add ${g} to 'endpoints'.`),Promise.resolve(null)}async function R(g,c={}){let o=t[g]||{url:String(g)},P=o.url;if(P.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");return P.includes("://")?await ue(P,c):await s.request(P,{...o,...c})}let m={config:e,endpoints:t,requestHandler:s,getInstance:r,request:R};return new Proxy(m,{get(g,c){return c in m?m[c]:t[c]?m.request.bind(null,c):n.bind(null,c)}})}async function ue(e,t={}){return z(t).request(e,t)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map