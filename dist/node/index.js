"use strict";var se=Object.defineProperty;var He=Object.getOwnPropertyDescriptor;var Qe=Object.getOwnPropertyNames;var Ne=Object.prototype.hasOwnProperty;var _e=(e,t)=>{for(var s in t)se(e,s,{get:t[s],enumerable:!0})},Se=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Qe(t))!Ne.call(e,n)&&n!==s&&se(e,n,{get:()=>t[n],enumerable:!(r=He(t,n))||r.enumerable});return e};var ke=e=>Se(se({},"__esModule",{value:!0}),e);var je={};_e(je,{createApiFetcher:()=>Le,fetchf:()=>le});module.exports=ke(je);async function O(e,t){if(t){if(typeof t=="function"){let s=await t(e);s&&Object.assign(e,s)}else if(Array.isArray(t))for(let s of t){let r=await s(e);r&&Object.assign(e,r)}}}var k=class extends Error{status;statusText;request;config;response;constructor(t,s,r){super(t),this.name="FetchError",this.message=t,this.status=r?.status||0,this.statusText=r?.statusText||"",this.request=s,this.config=s,this.response=r}};var M=class extends k{constructor(t,s,r){super(t,s,r),this.name="ResponseError"}};var L="application/",I=L+"json",Re="charset=utf-8",x="Content-Type",T="undefined",b="object",j="string",A="function",v="AbortError",me="TimeoutError",ye="CanceledError",U="GET",Pe="HEAD";var ge=10,De=["__proto__","constructor","prototype"];function ae(e){return e instanceof URLSearchParams}function $(e){return e!==null&&typeof e===b}function Ce(e){let t="";for(let s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t+=s+":"+e[s]);return t}function ne(e){if(!e||typeof e!==b||Array.isArray(e))return e;let t={...e};return De.forEach(s=>{delete t[s]}),t}function re(e){let t={},s=Object.keys(e);s.sort();for(let r=0,n=s.length;r<n;r++){let m=s[r];De.includes(m)||(t[m]=e[m])}return t}function he(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function qe(e,t){if(!t)return e;if(ae(t)){let c=t.toString();return he(e,c)}let s=[],r=encodeURIComponent,n=(c,o)=>{o=typeof o===A?o():o,o=o===null||o===void 0?"":o,s[s.length]=r(c)+"="+r(o)},m=(c,o,P=0)=>{if(P>=ge)return s;let d,h,D;if(c)if(Array.isArray(o))for(d=0,h=o.length;d<h;d++)m(c+"["+(typeof o[d]===b&&o[d]?d:"")+"]",o[d],P+1);else if($(o))for(D in o)m(c+"["+D+"]",o[D],P+1);else n(c,o);else if(Array.isArray(o))for(d=0,h=o.length;d<h;d++)n(o[d].name,o[d].value);else for(D in o)m(D,o[D],P+1);return s},g=m("",t).join("&").replace(/%5B%5D/g,"[]");return he(e,g)}function Te(e,t){return t?e.replace(/:\w+/g,s=>{let r=s.substring(1);return t[r]?encodeURIComponent(String(t[r])):s}):e}function Ee(e){let t=typeof e;return t===T||e===null?!1:t===j||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==T&&typeof globalThis.Buffer!==T&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!($(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===A))}async function J(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function oe(e,t=0){return t>=ge?e:e&&$(e)&&typeof e.data!==T&&Object.keys(e).length===1?oe(e.data,t+1):e}function be(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((s,r)=>{t[r]=s});else if($(e))for(let[s,r]of Object.entries(e))t[s.toLowerCase()]=r;return t}var H=new Map;async function we(e,t,s=0,r=!1,n=!0){let m=Date.now(),y=H.get(e);if(y){let o=y[3],P=y[0],d=y[1];if(!o&&m-y[2]<s)return P;o&&P.abort(new DOMException("Aborted due to new request",v)),d!==null&&clearTimeout(d),H.delete(e)}let g=new AbortController,c=n?setTimeout(()=>{let o=new DOMException(`${e.url} aborted due to timeout`,me);z(e,o)},t):null;return H.set(e,[g,c,m,r]),g}async function z(e,t=null){let s=H.get(e);if(s){let r=s[0],n=s[1];t&&!r.signal.aborted&&r.abort(t),n!==null&&clearTimeout(n),H.delete(e)}}async function Oe(e){if(!e?.body)return null;let t=String(e.headers?.get(x)||"").split(";")[0],s;try{if(t.includes(I)||t.includes("+json"))s=await e.json();else if(t.includes("multipart/form-data"))s=await e.formData();else if(t.includes(L+"octet-stream"))s=await e.blob();else if(t.includes(L+"x-www-form-urlencoded"))s=await e.formData();else if(t.includes("text/"))s=await e.text();else try{s=await e.clone().json()}catch{s=await e.text()}}catch{s=null}return s}function G(e){let t=0;for(let s=0,r=e.length;s<r;s++){let n=e.charCodeAt(s);t=t*31+n|0}return String(t)}var ie=new Map;function xe(e){let{url:t="",method:s=U,headers:r={},body:n="",mode:m="cors",credentials:y="include",cache:g="default",redirect:c="follow",referrer:o="",integrity:P=""}=e;if(g==="reload")return"";let d=Ce(re(r)),h="";if(n!==null)if(typeof n=="string")h=G(n);else if(n instanceof FormData)n.forEach((D,V)=>{h+=V+"="+D+"&"}),h=G(h);else if(typeof Blob!==T&&n instanceof Blob||typeof File!==T&&n instanceof File)h="BF"+n.size+n.type;else if(n instanceof ArrayBuffer||ArrayBuffer.isView(n))h="AB"+n.byteLength;else{let D=typeof n===b?re(n):String(n);h=G(JSON.stringify(D))}return(s+t+m+y+g+c+o+P+d+h).replace(/[^\w-_]/g,"")}function Me(e,t){return t?Date.now()-e>t*1e3:!1}function Fe(e,t){let s=ie.get(e);if(s){if(!Me(s.timestamp,t))return s;ie.delete(e)}return null}function Be(e,t,s=!1){ie.set(e,{data:t,isLoading:s,timestamp:Date.now()})}var ue={method:U,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:I+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function K(e){let t=ne(e),s={...ue,...t},r=(a,i,f,p)=>{p[a]&&(i[a]={...f[a],...p[a]})};r("retry",s,ue,t),r("headers",s,ue,t);let n=(a,i)=>typeof a[i]!==T?a[i]:s[i],m=n(t,"fetcher"),y=m?.create(s)||null,g=()=>y,c=(a,...i)=>{let f=n(a,"logger");f?.warn&&f.warn(...i)},o=(a,i,f)=>{if(!f&&["PUT","DELETE"].includes(i))return;let p=I+";"+Re;a instanceof Headers?a.has(x)||a.set(x,p):typeof a===b&&!Array.isArray(a)&&!a[x]&&(a[x]=p)},P=(a,i)=>{let f=n(i,"method").toUpperCase(),p=f===U||f===Pe,u=Te(a,n(i,"urlPathParams")),R=n(i,"params"),Q=n(i,"body")||n(i,"data"),C;p||(C=Q);let N=n(i,"headers");o(N,f,C);let _=n(i,"withCredentials")?"include":n(i,"credentials"),F=R?qe(u,R):u,w=F.includes("://")?"":n(i,"baseURL")||n(i,"apiUrl");return C&&typeof C!==j&&!ae(C)&&Ee(C)&&(C=JSON.stringify(C)),{...i,credentials:_,body:C,method:f,headers:N,url:w+F}},d=async(a,i)=>{D(a)||c(i,"API ERROR",a),await O(a,i?.onError),await O(a,s?.onError)},h=async(a,i,f)=>{let p=D(a),u=n(f,"strategy"),R=n(f,"rejectCancelled");if(!(p&&!R)){if(u==="silent")await new Promise(()=>null);else if(u==="reject")return Promise.reject(a)}return Y(i,f,a)},D=a=>a.name===v||a.name===ye,V=async(a,i=null)=>{let f=ne(i||{}),p={...s,...f};r("retry",p,s,f),r("headers",p,s,f);let u=null,R=P(a,p),{timeout:Q,cancellable:C,dedupeTime:N,pollingInterval:W,shouldStopPolling:_,cacheTime:F,cacheKey:X}=p,w;if(X?w=X(R):w=xe(R),F&&w){let B=p.cacheBuster;if(!B||!B(R)){let l=Fe(w,F);if(l)return l.data}}let{retries:S=0,delay:Ie,backoff:ce,retryOn:Ae,shouldRetry:Z,maxDelay:fe,resetTimeout:Ue}=p.retry,E=0,ee=0,q=Ie,pe=S>0?S:0;for(;E<=pe;)try{let l={signal:(await we(R,Q,N,C,!!(Q&&(!pe||Ue)))).signal,...R};if(await O(l,f?.onRequest),await O(l,s?.onRequest),m!==null&&y!==null&&typeof y.request===A?u=await y.request(l):u=await fetch(l.url,l),u instanceof Response&&(u.config=l,u.data=await Oe(u),!u.ok))throw new M(`${l.url} failed! Status: ${u.status||null}`,l,u);if(await O(u,f?.onResponse),await O(u,s?.onResponse),z(R),Z&&E<S&&await Z({config:R,request:R,response:u},E)){c(p,`Attempt ${E+1} failed response data check. Retry in ${q}ms.`),await J(q),q*=ce,q=Math.min(q,fe),E++;continue}if(W&&(!_||!_(u,ee))){ee++,c(l,"Polling attempt "+ee+"..."),await J(W);continue}let te=Y(u,l);if(F&&w){let de=l.skipCache;(!de||!de(te,l))&&Be(w,te)}return te}catch(B){let l=B;if(l.status=l?.status||u?.status||0,l.statusText=l?.statusText||u?.statusText||"",l.config=R,l.request=R,l.response=u,E===S||!Ae?.includes(l.status)||!await Z?.(l,E))return await d(l,R),z(R),h(l,u,R);c(p,`Attempt ${E+1} failed. Retry in ${q}ms.`),await J(q),q*=ce,q=Math.min(q,fe),E++}return Y(u,R)},Y=(a,i,f=null)=>{let p=n(i,"defaultResponse");if(!a)return{ok:!1,error:f,data:p,headers:null,config:i};let u=a?.data;return(u==null||typeof u===b&&Object.keys(u).length===0)&&(u=p),n(i,"flattenResponse")&&(a.data=oe(u)),a instanceof Response?{body:a.body,bodyUsed:a.bodyUsed,ok:a.ok,redirected:a.redirected,type:a.type,url:a.url,status:a.status,statusText:a.statusText,blob:()=>a.blob(),json:()=>a.json(),text:()=>a.text(),clone:()=>a.clone(),arrayBuffer:()=>a.arrayBuffer(),formData:()=>a.formData(),bytes:()=>a.bytes(),error:f,data:u,headers:be(a.headers),config:i}:a};return{getInstance:g,buildConfig:P,config:s,request:V}}function Le(e){let t=e.endpoints,s=K(e);function r(){return s.getInstance()}function n(g){return console.error(`Add ${g} to 'endpoints'.`),Promise.resolve(null)}async function m(g,c={}){let o=t[g]||{url:String(g)},P=o.url;if(P.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");return P.includes("://")?await le(P,c):await s.request(P,{...o,...c})}let y={config:e,endpoints:t,requestHandler:s,getInstance:r,request:m};return new Proxy(y,{get(g,c){return c in y?y[c]:t[c]?y.request.bind(null,c):n.bind(null,c)}})}async function le(e,t={}){return K(t).request(e,t)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map