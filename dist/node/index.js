"use strict";var G=Object.defineProperty;var _e=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var Me=Object.prototype.hasOwnProperty;var ke=(e,t)=>{for(var r in t)G(e,r,{get:t[r],enumerable:!0})},Le=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Se(t))!Me.call(e,s)&&s!==r&&G(e,s,{get:()=>t[s],enumerable:!(n=_e(t,s))||n.enumerable});return e};var je=e=>Le(G({},"__esModule",{value:!0}),e);var Ge={};ke(Ge,{createApiFetcher:()=>He,fetchf:()=>te});module.exports=je(Ge);async function q(e,t){if(t){if(typeof t=="function"){let r=await t(e);r&&Object.assign(e,r)}else if(Array.isArray(t))for(let r of t){let n=await r(e);n&&Object.assign(e,n)}}}var Q=class extends Error{constructor(r,n,s){super(r);this.request=n;this.response=s;this.name="FetchError",this.status=s?.status||0,this.statusText=s?.statusText||"",this.config=n}status;statusText;config};var U=class extends Q{constructor(t,r,n){super(t,r,n),this.name="ResponseError"}};var N="application/",F=N+"json",ce="charset=utf-8",b="Content-Type",C="undefined",P="object",_="string",K="function",S="AbortError",fe="TimeoutError",pe="CanceledError",x="GET",me="HEAD";var Re=10,ye=["__proto__","constructor","prototype"];function V(e){return e instanceof URLSearchParams}function M(e){return e!==null&&typeof e===P}function Pe(e){let t="";for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t+=r+":"+e[r]);return t}function Y(e){if(!e||typeof e!==P||Array.isArray(e))return e;let t={...e};return ye.forEach(r=>{delete t[r]}),t}function W(e){let t={},r=Object.keys(e);r.sort();for(let n=0,s=r.length;n<s;n++){let i=r[n];ye.includes(i)||(t[i]=e[i])}return t}function de(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function he(e,t){if(!t)return e;if(V(t)){let u=t.toString();return de(e,u)}let r=[],n=encodeURIComponent,s=(u,a)=>{a=typeof a===K?a():a,a=a===null||a===void 0?"":a,r[r.length]=n(u)+"="+n(a)},i=(u,a,o=0)=>{if(o>=Re)return r;let l,f,d;if(u)if(Array.isArray(a))for(l=0,f=a.length;l<f;l++)i(u+"["+(typeof a[l]===P&&a[l]?l:"")+"]",a[l],o+1);else if(M(a))for(d in a)i(u+"["+d+"]",a[d],o+1);else s(u,a);else if(Array.isArray(a))for(l=0,f=a.length;l<f;l++)s(a[l].name,a[l].value);else for(d in a)i(d,a[d],o+1);return r},p=i("",t).join("&").replace(/%5B%5D/g,"[]");return de(e,p)}function ge(e,t){if(!t||e.indexOf(":")===-1)return e;let r=t;return e.replace(/:([a-zA-Z0-9_]+)/g,(n,s)=>{if(Object.prototype.hasOwnProperty.call(r,s)){let i=r[s];if(i!=null)return encodeURIComponent(String(i))}return n})}function De(e){let t=typeof e;return t===C||e===null?!1:t===_||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==C&&typeof globalThis.Buffer!==C&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(M(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===K))}async function O(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function X(e,t=0){return t>=Re?e:e&&M(e)&&typeof e.data!==C&&Object.keys(e).length===1?X(e.data,t+1):e}function Ce(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((r,n)=>{t[n]=r});else if(M(e))for(let[r,n]of Object.entries(e))t[r.toLowerCase()]=n;return t}var E=new Map;async function Ee(e,t,r,n=0,s=!1,i=!0){if(!e)return new AbortController;let m=Date.now(),p=E.get(e);if(p){let o=p[3],l=p[0],f=p[1];if(!o&&m-p[2]<n)return l;o&&l.abort(new DOMException("Aborted due to new request",S)),f!==null&&clearTimeout(f),E.delete(e)}let u=new AbortController,a=i?setTimeout(()=>{let o=new DOMException(`${t} aborted due to timeout`,fe);k(e,o)},r):null;return E.set(e,[u,a,m,s]),u}async function k(e,t=null){if(!e)return;let r=E.get(e);if(r){let n=r[0],s=r[1];t&&!n.signal.aborted&&n.abort(t),s!==null&&clearTimeout(s),E.delete(e)}}function Te(e,t){let r=E.get(e);r&&(r[4]=t,E.set(e,r))}function we(e,t){let r=E.get(e);return r&&r[4]&&Date.now()-r[2]<t?r[4]:null}async function qe(e){if(!e?.body)return null;let t=e.headers?.get(b);t?t=t.toLowerCase().trim():t="";let r=t.split(";",1)[0],n;try{if(r.includes(F)||r.includes("+json"))n=await e.json();else if(r.includes("multipart/form-data"))n=await e.formData();else if(r.includes(N+"octet-stream"))n=await e.blob();else if(r.includes(N+"x-www-form-urlencoded"))n=await e.formData();else if(r.startsWith("text/"))n=await e.text();else try{n=await e.clone().json()}catch{n=await e.text()}}catch{n=null}return n}var L=(e,t,r=null)=>{let n=t.defaultResponse??null;if(!e)return{ok:!1,error:r,data:n,headers:null,config:t};let s=e.data;return(s==null||typeof s===P&&Object.keys(s).length===0)&&(s=n),t.flattenResponse&&(e.data=X(s)),e instanceof Response?{body:e.body,bodyUsed:e.bodyUsed,ok:e.ok,redirected:e.redirected,type:e.type,url:e.url,status:e.status,statusText:e.statusText,blob:()=>e.blob(),json:()=>e.json(),text:()=>e.text(),clone:()=>e.clone(),arrayBuffer:()=>e.arrayBuffer(),formData:()=>e.formData(),bytes:()=>e.bytes(),error:r,data:s,headers:Ce(e.headers),config:t}:e};function I(e){let t=0;for(let r=0,n=e.length;r<n;r++){let s=e.charCodeAt(r);t=t*31+s|0}return String(t)}var Z=new Map,j="|",v=64;function be(e){let{url:t="",method:r=x,headers:n=null,body:s=void 0,mode:i="cors",credentials:m="same-origin",cache:p="default",redirect:u="follow",referrer:a="about:client",integrity:o=""}=e;if(p==="reload")return"";let l="";if(n){let d=n instanceof Headers?Object.fromEntries(n.entries()):n;l=Pe(W(d)),l.length>v&&(l=I(l))}let f="";if(s)if(typeof s=="string")f=s.length<v?s:I(s);else if(s instanceof FormData)s.forEach((d,w)=>{f+=w+"="+d+"&"}),f.length>v&&(f=I(f));else if(typeof Blob!==C&&s instanceof Blob||typeof File!==C&&s instanceof File)f="BF"+s.size+s.type;else if(s instanceof ArrayBuffer||ArrayBuffer.isView(s))f="AB"+s.byteLength;else{let d=typeof s===P?JSON.stringify(W(s)):String(s);f=d.length>v?I(d):d}return(r+j+t+j+i+m+p+u+a+o+j+l+j+f).replace(/[^\w\-_|]/g,"")}function ve(e,t){return t?Date.now()-e>t*1e3:!1}function $e(e,t){let r=Z.get(e);if(r){if(!ve(r.timestamp,t))return r;Je(e)}return null}function xe(e,t,r=!1){Z.set(e,{data:t,isLoading:r,timestamp:Date.now()})}function Je(e){Z.delete(e)}function Oe(e,t,r,n){if(!t||!e||r?.(n))return null;let s=$e(e,t);return s?s.data:null}var $={method:x,strategy:"reject",timeout:3e4,dedupeTime:0,defaultResponse:null,headers:{Accept:F+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}},Fe=(e,t)=>{let r=(t.method??x).toUpperCase(),n=r===x||r===me,s=ge(e,t.urlPathParams),i;n||(i=t.body??t.data),ze(r,t.headers,i);let m=t.withCredentials?"include":t.credentials,p=t.params,u=p?he(s,p):s,o=u.includes("://")?"":t.baseURL??t.apiUrl;return i&&typeof i!==_&&!V(i)&&De(i)&&(i=JSON.stringify(i)),{...t,url:o+u,method:r,credentials:m,body:i}},ze=(e,t,r)=>{if(!t||!r&&["PUT","DELETE"].includes(e))return;let n=F+";"+ce;t instanceof Headers?t.has(b)||t.set(b,n):typeof t===P&&!Array.isArray(t)&&!t[b]&&(t[b]=n)},T=(e,t,r,n)=>{n[e]&&(t[e]={...r[e],...n[e]})};function Ie(e){let t=e?.headers?.["retry-after"];if(!t)return null;let r=Number(t);if(!isNaN(r)&&r>=0)return r*1e3;let n=new Date(t);if(!isNaN(n.getTime())){let s=n.getTime()-Date.now();return s>0?s:0}return null}async function Ae(e,t,r,n=0,s=0){let i=0,m;for(;(n===0||i<n)&&(s>0&&await O(s),m=await e(),i++,!(n>0&&i>=n||!t||r&&r(m,i)));)await O(t);return m}function J(e){let t=e?Y(e):{},r={...$,...t};T("retry",r,$,t),T("headers",r,$,t);let n=t.fetcher?.create?.(r);return{getInstance:()=>n||null,config:r,request:async(m,p=null)=>{let u=p?Y(p):{},a={...r,...u};T("retry",a,r,u),T("headers",a,r,u);let o=null,l=Fe(m,a),{timeout:f,cancellable:d,dedupeTime:w,cacheTime:A,cacheKey:re,pollingInterval:ne=0}=a,y=null;if((A||w||d||f)&&(y=re?re(l):be(l)),A){let g=Oe(y,A,a.cacheBuster,l);if(g)return g}if(y&&w){let g=we(y,w);if(g)return await g}let se=async()=>{let{retries:g=0,delay:Qe,backoff:oe,retryOn:Ue,shouldRetry:B,maxDelay:ie,resetTimeout:Ne}=a.retry,h=0,R=Qe||0,H=g>0?g:0;for(;h<=H;)try{let c={signal:(await Ee(y,l.url,f,w,d,!!(f&&(!H||Ne)))).signal,...l};if(await q(c,u.onRequest),await q(c,r.onRequest),o=n?.request?await n.request(c):await fetch(c.url,c),o instanceof Response&&(o.config=c,o.data=await qe(o),!o.ok))throw new U(`${c.method} to ${c.url} failed! Status: ${o.status||null}`,c,o);await q(o,u.onResponse),await q(o,r.onResponse),k(y);let D=L(o,c);if(B&&h<H&&await B(D,h)){ee(a,`Attempt ${h+1} failed response data check. Retry in ${R}ms.`),await O(R),R*=oe||1,R=Math.min(R,ie||R),h++;continue}return A&&y&&(!c.skipCache||!c.skipCache(D,c))&&xe(y,D),D}catch(ue){let c=ue;c.status=c?.status||o?.status||0,c.statusText=c?.statusText||o?.statusText||"",c.config=l,c.request=l,c.response=o;let D=L(o,l,c);if(h===H||!Ue?.includes(c.status)||!B||!await B(D,h)){if(Be(c)||ee(a,"FETCH ERROR",c),await q(c,u.onError),await q(c,r.onError),k(y),!Be(c)||a.rejectCancelled){let le=a.strategy;if(le==="reject")return Promise.reject(c);le==="silent"&&await new Promise(()=>null)}return D}if(c.status===429){let z=Ie(D);z!==null&&(R=z)}ee(a,`Attempt ${h+1} failed. Retry in ${R}ms.`),await O(R),R*=oe||1,R=Math.min(R,ie||R),h++}return L(o,l)},ae=ne>0?Ae(se,ne,a.shouldStopPolling,a.maxPollingAttempts,a.pollingDelay):se();return y&&w&&Te(y,ae),ae}}}var Be=e=>e.name===S||e.name===pe,ee=(e,...t)=>{let r=e.logger;r&&r.warn&&r.warn(...t)};function He(e){let t=e.endpoints,r=J(e);function n(){return r.getInstance()}function s(p){return console.error(`Add ${p} to 'endpoints'.`),Promise.resolve(null)}async function i(p,u={}){let a=t[p]||{url:String(p)},o=a.url;if(o.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");if(o.includes("://"))return await te(o,u);let f={...a,...u};return T("retry",f,a,u),T("headers",f,a,u),await r.request(o,f)}let m={config:e,endpoints:t,requestHandler:r,getInstance:n,request:i};return new Proxy(m,{get(p,u){return u in m?m[u]:t[u]?m.request.bind(null,u):s.bind(null,u)}})}async function te(e,t={}){return J(t).request(e)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map