'use strict';var react=require('react'),fetchff=require('fetchff');var P=-1,p=2e3,i=new Map,A=e=>{e&&i.set(e,(i.get(e)||0)+1);},I=(e,t,r,o)=>{if(!e)return;let a=f(e);if(!a)return;let h=a-1;h<=0?(i.delete(e),t===P&&fetchff.addTimeout("r:"+e,()=>{fetchff.abortRequest(e,new DOMException("Request to "+o+" aborted","AbortError")),f(e)||fetchff.deleteCache(e,true);},r!=null?r:p)):i.set(e,h);},f=e=>e&&i.get(e)||0;var W=300,K=Object.freeze({data:null,error:null,isFetching:false,mutate:()=>Promise.resolve(null),config:{},headers:{}}),S=Object.freeze({...K,isFetching:true}),X=[null,{},null],Y=new Set(["GET","HEAD","get","head"]);function re(e,t={}){var g,T,b;let r=react.useMemo(()=>e===null?null:fetchff.generateCacheKey(fetchff.buildConfig(e,t)),[t.cacheKey,e,t.url,t.method,t.headers,t.body,t.params,t.urlPathParams,t.apiUrl,t.baseURL,t.withCredentials,t.credentials]),o=(g=t.dedupeTime)!=null?g:p,a=t.cacheTime||P,h=(T=t.staleTime)!=null?T:W,m=(b=t.immediate)!=null?b:Y.has(t.method||"GET"),R=react.useRef(X);R.current=[e,t,r];let D=react.useCallback(()=>{let s=fetchff.getCache(r);if(t.strategy==="reject"&&r&&(!s||!s.data.data&&!s.data.error)){let l=fetchff.getInFlightPromise(r,o);if(l)throw l;if(!s){let[n,u,d]=R.current;if(n)throw fetchff.fetchf(n,{...u,cacheKey:d,dedupeTime:o,cacheTime:a,staleTime:h,strategy:"softFail",cacheErrors:true,_isAutoKey:!u.cacheKey})}}return s?s.data.isFetching&&!t.keepPreviousData?S:s.data:m?S:K},[r]),x=react.useCallback(s=>{A(r),m&&e&&r&&f(r)===1&&(fetchff.getCachedResponse(r,a,t)||F(false));let n=fetchff.subscribe(r,s);return ()=>{I(r,a,o,e),n();}},[r,m,e,o,a]),c=react.useSyncExternalStore(x,D,D),F=react.useCallback(async(s=true)=>{let[l,n,u]=R.current;if(!l)return Promise.resolve(null);let d=!!s;if(!d&&u){let _=fetchff.getCachedResponse(u,a,n);if(_)return Promise.resolve(_)}let U=d?()=>true:n.cacheBuster;return fetchff.fetchf(l,{...n,cacheKey:u,dedupeTime:o,cacheTime:a,staleTime:h,cacheBuster:U,strategy:"softFail",cacheErrors:true,_isAutoKey:!n.cacheKey})},[a,o]),y=c.data,L=!y&&!c.error,C=c.isFetching,w=!!e&&(C||L&&m);return {data:y,error:c.error,config:c.config,headers:c.headers,isFetching:C,isLoading:w,mutate:c.mutate,refetch:F}}exports.useFetcher=re;//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map