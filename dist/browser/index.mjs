var Be=Object.defineProperty;var He=(e,t,a)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var E=(e,t,a)=>He(e,typeof t!="symbol"?t+"":t,a);async function D(e,t){if(t){if(typeof t=="function"){let a=await t(e);a&&Object.assign(e,a)}else if(Array.isArray(t))for(let a of t){let r=await a(e);r&&Object.assign(e,r)}}}var A=class extends Error{constructor(a,r,n){super(a);E(this,"status");E(this,"statusText");E(this,"request");E(this,"config");E(this,"response");this.name="FetchError",this.message=a,this.status=(n==null?void 0:n.status)||0,this.statusText=(n==null?void 0:n.statusText)||"",this.request=r,this.config=r,this.response=n}};var I=class extends A{constructor(t,a,r){super(t,a,r),this.name="ResponseError"}};var B="application/",b=B+"json",ue="charset=utf-8",C="Content-Type",g="undefined",P="object",H="string",K="function",U="AbortError",le="TimeoutError",ce="CanceledError",T="GET",fe="HEAD";var de=10,me=["__proto__","constructor","prototype"];function V(e){return e instanceof URLSearchParams}function Q(e){return e!==null&&typeof e===P}function Re(e){let t="";for(let a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t+=a+":"+e[a]);return t}function Y(e){if(!e||typeof e!==P||Array.isArray(e))return e;let t={...e};return me.forEach(a=>{delete t[a]}),t}function W(e){let t={},a=Object.keys(e);a.sort();for(let r=0,n=a.length;r<n;r++){let o=a[r];me.includes(o)||(t[o]=e[o])}return t}function pe(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function ye(e,t){if(!t)return e;if(V(t)){let f=t.toString();return pe(e,f)}let a=[],r=encodeURIComponent,n=(f,s)=>{s=typeof s===K?s():s,s=s===null||s===void 0?"":s,a[a.length]=r(f)+"="+r(s)},o=(f,s,m=0)=>{if(m>=de)return a;let l,c,i;if(f)if(Array.isArray(s))for(l=0,c=s.length;l<c;l++)o(f+"["+(typeof s[l]===P&&s[l]?l:"")+"]",s[l],m+1);else if(Q(s))for(i in s)o(f+"["+i+"]",s[i],m+1);else n(f,s);else if(Array.isArray(s))for(l=0,c=s.length;l<c;l++)n(s[l].name,s[l].value);else for(i in s)o(i,s[i],m+1);return a},d=o("",t).join("&").replace(/%5B%5D/g,"[]");return pe(e,d)}function Pe(e,t){if(!t||e.indexOf(":")===-1)return e;let a=t;return e.replace(/:([a-zA-Z0-9_]+)/g,(r,n)=>{if(Object.prototype.hasOwnProperty.call(a,n)){let o=a[n];if(o!=null)return encodeURIComponent(String(o))}return r})}function he(e){let t=typeof e;return t===g||e===null?!1:t===H||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==g&&typeof globalThis.Buffer!==g&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(Q(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===K))}async function N(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function X(e,t=0){return t>=de?e:e&&Q(e)&&typeof e.data!==g&&Object.keys(e).length===1?X(e.data,t+1):e}function ge(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((a,r)=>{t[r]=a});else if(Q(e))for(let[a,r]of Object.entries(e))t[a.toLowerCase()]=r;return t}var x=new Map;async function De(e,t,a=0,r=!1,n=!0){let o=Date.now(),R=x.get(e);if(R){let s=R[3],m=R[0],l=R[1];if(!s&&o-R[2]<a)return m;s&&m.abort(new DOMException("Aborted due to new request",U)),l!==null&&clearTimeout(l),x.delete(e)}let d=new AbortController,f=n?setTimeout(()=>{let s=new DOMException(`${e.url} aborted due to timeout`,le);_(e,s)},t):null;return x.set(e,[d,f,o,r]),d}async function _(e,t=null){let a=x.get(e);if(a){let r=a[0],n=a[1];t&&!r.signal.aborted&&r.abort(t),n!==null&&clearTimeout(n),x.delete(e)}}async function Ce(e){var n;if(!(e!=null&&e.body))return null;let t=(n=e.headers)==null?void 0:n.get(C);t?t=t.toLowerCase().trim():t="";let a=t.split(";",1)[0],r;try{if(a.includes(b)||a.includes("+json"))r=await e.json();else if(a.includes("multipart/form-data"))r=await e.formData();else if(a.includes(B+"octet-stream"))r=await e.blob();else if(a.includes(B+"x-www-form-urlencoded"))r=await e.formData();else if(a.startsWith("text/"))r=await e.text();else try{r=await e.clone().json()}catch(o){r=await e.text()}}catch(o){r=null}return r}var S=(e,t,a=null)=>{var o;let r=(o=t.defaultResponse)!=null?o:null;if(!e)return{ok:!1,error:a,data:r,headers:null,config:t};let n=e==null?void 0:e.data;return(n==null||typeof n===P&&Object.keys(n).length===0)&&(n=r),t.flattenResponse&&(e.data=X(n)),e instanceof Response?{body:e.body,bodyUsed:e.bodyUsed,ok:e.ok,redirected:e.redirected,type:e.type,url:e.url,status:e.status,statusText:e.statusText,blob:()=>e.blob(),json:()=>e.json(),text:()=>e.text(),clone:()=>e.clone(),arrayBuffer:()=>e.arrayBuffer(),formData:()=>e.formData(),bytes:()=>e.bytes(),error:a,data:n,headers:ge(e.headers),config:t}:e};function M(e){let t=0;for(let a=0,r=e.length;a<r;a++){let n=e.charCodeAt(a);t=t*31+n|0}return String(t)}var Z=new Map;function Ee(e){let{url:t="",method:a=T,headers:r={},body:n="",mode:o="cors",credentials:R="include",cache:d="default",redirect:f="follow",referrer:s="",integrity:m=""}=e;if(d==="reload")return"";let l=Re(W(r)),c="";if(n!==null)if(typeof n=="string")c=M(n);else if(n instanceof FormData)n.forEach((i,p)=>{c+=p+"="+i+"&"}),c=M(c);else if(typeof Blob!==g&&n instanceof Blob||typeof File!==g&&n instanceof File)c="BF"+n.size+n.type;else if(n instanceof ArrayBuffer||ArrayBuffer.isView(n))c="AB"+n.byteLength;else{let i=typeof n===P?W(n):String(n);c=M(JSON.stringify(i))}return(a+t+o+R+d+f+s+m+l+c).replace(/[^\w-_]/g,"")}function Ue(e,t){return t?Date.now()-e>t*1e3:!1}function Te(e,t){let a=Z.get(e);if(a){if(!Ue(a.timestamp,t))return a;Z.delete(e)}return null}function qe(e,t,a=!1){Z.set(e,{data:t,isLoading:a,timestamp:Date.now()})}var k={method:T,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:b+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}},be=(e,t)=>{var c,i,p;let a=((c=t.method)!=null?c:T).toUpperCase(),r=a===T||a===fe,n=Pe(e,t.urlPathParams),o;r||(o=(i=t.body)!=null?i:t.data);let R=t.headers;Qe(a,R,o);let d=t.withCredentials?"include":t.credentials,f=t.params,s=f?ye(n,f):n,l=s.includes("://")?"":(p=t.baseURL)!=null?p:t.apiUrl;return o&&typeof o!==H&&!V(o)&&he(o)&&(o=JSON.stringify(o)),{...t,url:l+s,method:a,credentials:d,body:o}},Qe=(e,t,a)=>{if(!a&&["PUT","DELETE"].includes(e))return;let r=b+";"+ue;t instanceof Headers?t.has(C)||t.set(C,r):typeof t===P&&!Array.isArray(t)&&!t[C]&&(t[C]=r)},O=(e,t,a,r)=>{r[e]&&(t[e]={...a[e],...r[e]})};function j(e){var d,f;let t=e?Y(e):{},a={...k,...t};O("retry",a,k,t),O("headers",a,k,t);let r=(f=(d=t.fetcher)==null?void 0:d.create)==null?void 0:f.call(d,a),n=()=>r||null,o=async(s,m,l)=>{if(!xe(s)||l.rejectCancelled){let p=l.strategy;if(p==="reject")return Promise.reject(s);p==="silent"&&await new Promise(()=>null)}return S(m,l,s)};return{getInstance:n,config:a,request:async(s,m=null)=>{var ie;let l=m?Y(m):{},c={...a,...l};O("retry",c,a,l),O("headers",c,a,l);let i=null,p=be(s,c),{timeout:ee,cancellable:we,dedupeTime:Fe,pollingInterval:te,shouldStopPolling:ae,cacheTime:$,cacheKey:re}=c,q=null;if($&&(q=re?re(p):Ee(p),q&&!((ie=c.cacheBuster)==null?void 0:ie.call(c,p)))){let u=Te(q,$);if(u)return u.data}let{retries:w=0,delay:Ae,backoff:ne,retryOn:v,shouldRetry:F,maxDelay:se,resetTimeout:Ie}=c.retry,h=0,J=0,y=Ae,oe=w>0?w:0;for(;h<=oe;)try{let u={signal:(await De(p,ee,Fe,we,!!(ee&&(!oe||Ie)))).signal,...p};if(await D(u,l.onRequest),await D(u,a.onRequest),i=r!=null&&r.request?await r.request(u):await fetch(u.url,u),i instanceof Response&&(i.config=u,i.data=await Ce(i),!i.ok))throw new I(`${u.method} to ${u.url} failed! Status: ${i.status||null}`,u,i);if(await D(i,l.onResponse),await D(i,a.onResponse),_(p),F&&h<w&&await F({config:p,request:p,response:i},h)){L(c,`Attempt ${h+1} failed response data check. Retry in ${y}ms.`),await N(y),y*=ne,y=Math.min(y,se),h++;continue}if(te&&(!ae||!ae(i,J))){J++,L(c,"Polling attempt "+J+"..."),await N(te);continue}let G=S(i,u);return $&&q&&u.skipCache&&!u.skipCache(G,u)&&qe(q,G),G}catch(z){let u=z;if(u.status=(u==null?void 0:u.status)||(i==null?void 0:i.status)||0,u.statusText=(u==null?void 0:u.statusText)||(i==null?void 0:i.statusText)||"",u.config=p,u.request=p,u.response=i,h===w||!(v!=null&&v.includes(u.status))||!F||!await F(u,h))return xe(u)||L(c,"API ERROR",u),await D(u,l.onError),await D(u,a.onError),_(p),o(u,i,p);L(c,`Attempt ${h+1} failed. Retry in ${y}ms.`),await N(y),y*=ne,y=Math.min(y,se),h++}return S(i,p)}}}var xe=e=>e.name===U||e.name===ce,L=(e,...t)=>{let a=e.logger;a&&a.warn&&a.warn(...t)};function Ne(e){let t=e.endpoints,a=j(e);function r(){return a.getInstance()}function n(d){return console.error(`Add ${d} to 'endpoints'.`),Promise.resolve(null)}async function o(d,f={}){let s=t[d]||{url:String(d)},m=s.url;if(m.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");return m.includes("://")?await Oe(m,f):await a.request(m,{...s,...f})}let R={config:e,endpoints:t,requestHandler:a,getInstance:r,request:o};return new Proxy(R,{get(d,f){return f in R?R[f]:t[f]?R.request.bind(null,f):n.bind(null,f)}})}async function Oe(e,t={}){return j(t).request(e)}export{Ne as createApiFetcher,Oe as fetchf};
//# sourceMappingURL=index.mjs.map