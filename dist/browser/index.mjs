var Ue=Object.defineProperty;var Ne=(e,t,r)=>t in e?Ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var T=(e,t,r)=>Ne(e,typeof t!="symbol"?t+"":t,r);async function D(e,t){if(t){if(typeof t=="function"){let r=await t(e);r&&Object.assign(e,r)}else if(Array.isArray(t))for(let r of t){let a=await r(e);a&&Object.assign(e,a)}}}var I=class extends Error{constructor(r,a,n){super(r);T(this,"status");T(this,"statusText");T(this,"request");T(this,"config");T(this,"response");this.name="FetchError",this.message=r,this.status=(n==null?void 0:n.status)||0,this.statusText=(n==null?void 0:n.statusText)||"",this.request=a,this.config=a,this.response=n}};var B=class extends I{constructor(t,r,a){super(t,r,a),this.name="ResponseError"}};var H="application/",b=H+"json",le="charset=utf-8",C="Content-Type",g="undefined",y="object",U="string",V="function",N="AbortError",ce="TimeoutError",fe="CanceledError",E="GET",pe="HEAD";var me=10,Re=["__proto__","constructor","prototype"];function Y(e){return e instanceof URLSearchParams}function Q(e){return e!==null&&typeof e===y}function ye(e){let t="";for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t+=r+":"+e[r]);return t}function W(e){if(!e||typeof e!==y||Array.isArray(e))return e;let t={...e};return Re.forEach(r=>{delete t[r]}),t}function X(e){let t={},r=Object.keys(e);r.sort();for(let a=0,n=r.length;a<n;a++){let s=r[a];Re.includes(s)||(t[s]=e[s])}return t}function de(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function he(e,t){if(!t)return e;if(Y(t)){let c=t.toString();return de(e,c)}let r=[],a=encodeURIComponent,n=(c,o)=>{o=typeof o===V?o():o,o=o===null||o===void 0?"":o,r[r.length]=a(c)+"="+a(o)},s=(c,o,p=0)=>{if(p>=me)return r;let l,i,f;if(c)if(Array.isArray(o))for(l=0,i=o.length;l<i;l++)s(c+"["+(typeof o[l]===y&&o[l]?l:"")+"]",o[l],p+1);else if(Q(o))for(f in o)s(c+"["+f+"]",o[f],p+1);else n(c,o);else if(Array.isArray(o))for(l=0,i=o.length;l<i;l++)n(o[l].name,o[l].value);else for(f in o)s(f,o[f],p+1);return r},m=s("",t).join("&").replace(/%5B%5D/g,"[]");return de(e,m)}function Pe(e,t){if(!t||e.indexOf(":")===-1)return e;let r=t;return e.replace(/:([a-zA-Z0-9_]+)/g,(a,n)=>{if(Object.prototype.hasOwnProperty.call(r,n)){let s=r[n];if(s!=null)return encodeURIComponent(String(s))}return a})}function ge(e){let t=typeof e;return t===g||e===null?!1:t===U||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==g&&typeof globalThis.Buffer!==g&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(Q(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===V))}async function _(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function Z(e,t=0){return t>=me?e:e&&Q(e)&&typeof e.data!==g&&Object.keys(e).length===1?Z(e.data,t+1):e}function De(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((r,a)=>{t[a]=r});else if(Q(e))for(let[r,a]of Object.entries(e))t[r.toLowerCase()]=a;return t}var w=new Map;async function Ce(e,t,r=0,a=!1,n=!0){let s=Date.now(),d=w.get(e);if(d){let o=d[3],p=d[0],l=d[1];if(!o&&s-d[2]<r)return p;o&&p.abort(new DOMException("Aborted due to new request",N)),l!==null&&clearTimeout(l),w.delete(e)}let m=new AbortController,c=n?setTimeout(()=>{let o=new DOMException(`${e.url} aborted due to timeout`,ce);S(e,o)},t):null;return w.set(e,[m,c,s,a]),m}async function S(e,t=null){let r=w.get(e);if(r){let a=r[0],n=r[1];t&&!a.signal.aborted&&a.abort(t),n!==null&&clearTimeout(n),w.delete(e)}}async function Te(e){var n;if(!(e!=null&&e.body))return null;let t=(n=e.headers)==null?void 0:n.get(C);t?t=t.toLowerCase().trim():t="";let r=t.split(";",1)[0],a;try{if(r.includes(b)||r.includes("+json"))a=await e.json();else if(r.includes("multipart/form-data"))a=await e.formData();else if(r.includes(H+"octet-stream"))a=await e.blob();else if(r.includes(H+"x-www-form-urlencoded"))a=await e.formData();else if(r.startsWith("text/"))a=await e.text();else try{a=await e.clone().json()}catch(s){a=await e.text()}}catch(s){a=null}return a}var M=(e,t,r=null)=>{var s;let a=(s=t.defaultResponse)!=null?s:null;if(!e)return{ok:!1,error:r,data:a,headers:null,config:t};let n=e==null?void 0:e.data;return(n==null||typeof n===y&&Object.keys(n).length===0)&&(n=a),t.flattenResponse&&(e.data=Z(n)),e instanceof Response?{body:e.body,bodyUsed:e.bodyUsed,ok:e.ok,redirected:e.redirected,type:e.type,url:e.url,status:e.status,statusText:e.statusText,blob:()=>e.blob(),json:()=>e.json(),text:()=>e.text(),clone:()=>e.clone(),arrayBuffer:()=>e.arrayBuffer(),formData:()=>e.formData(),bytes:()=>e.bytes(),error:r,data:n,headers:De(e.headers),config:t}:e};function k(e){let t=0;for(let r=0,a=e.length;r<a;r++){let n=e.charCodeAt(r);t=t*31+n|0}return String(t)}var ee=new Map;function Ee(e){let{url:t="",method:r=E,headers:a={},body:n="",mode:s="cors",credentials:d="include",cache:m="default",redirect:c="follow",referrer:o="",integrity:p=""}=e;if(m==="reload")return"";let l=ye(X(a)),i="";if(n!==null)if(typeof n=="string")i=k(n);else if(n instanceof FormData)n.forEach((f,O)=>{i+=O+"="+f+"&"}),i=k(i);else if(typeof Blob!==g&&n instanceof Blob||typeof File!==g&&n instanceof File)i="BF"+n.size+n.type;else if(n instanceof ArrayBuffer||ArrayBuffer.isView(n))i="AB"+n.byteLength;else{let f=typeof n===y?X(n):String(n);i=k(JSON.stringify(f))}return(r+t+s+d+m+c+o+p+l+i).replace(/[^\w-_]/g,"")}function Qe(e,t){return t?Date.now()-e>t*1e3:!1}function qe(e,t){let r=ee.get(e);if(r){if(!Qe(r.timestamp,t))return r;ee.delete(e)}return null}function be(e,t,r=!1){ee.set(e,{data:t,isLoading:r,timestamp:Date.now()})}var L={method:E,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:b+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}},we=(e,t)=>{var l,i,f;let r=((l=t.method)!=null?l:E).toUpperCase(),a=r===E||r===pe,n=Pe(e,t.urlPathParams),s;a||(s=(i=t.body)!=null?i:t.data),_e(r,t.headers,s);let d=t.withCredentials?"include":t.credentials,m=t.params,c=m?he(n,m):n,p=c.includes("://")?"":(f=t.baseURL)!=null?f:t.apiUrl;return s&&typeof s!==U&&!Y(s)&&ge(s)&&(s=JSON.stringify(s)),{...t,url:p+c,method:r,credentials:d,body:s}},_e=(e,t,r)=>{if(!t||!r&&["PUT","DELETE"].includes(e))return;let a=b+";"+le;t instanceof Headers?t.has(C)||t.set(C,a):typeof t===y&&!Array.isArray(t)&&!t[C]&&(t[C]=a)},x=(e,t,r,a)=>{a[e]&&(t[e]={...r[e],...a[e]})};function xe(e){var n;let t=(n=e==null?void 0:e.headers)==null?void 0:n["retry-after"];if(!t)return null;let r=Number(t);if(!isNaN(r)&&r>=0)return r*1e3;let a=new Date(t);if(!isNaN(a.getTime())){let s=a.getTime()-Date.now();return s>0?s:0}return null}function v(e){var d,m;let t=e?W(e):{},r={...L,...t};x("retry",r,L,t),x("headers",r,L,t);let a=(m=(d=t.fetcher)==null?void 0:d.create)==null?void 0:m.call(d,r);return{getInstance:()=>a||null,config:r,request:async(c,o=null)=>{var ie;let p=o?W(o):{},l={...r,...p};x("retry",l,r,p),x("headers",l,r,p);let i=null,f=we(c,l),{timeout:O,cancellable:Fe,dedupeTime:Ie,pollingInterval:te,shouldStopPolling:re,cacheTime:$,cacheKey:ae}=l,q=null;if($&&(q=ae?ae(f):Ee(f),q&&!((ie=l.cacheBuster)==null?void 0:ie.call(l,f)))){let u=qe(q,$);if(u)return u.data}let{retries:A=0,delay:Be,backoff:ne,retryOn:J,shouldRetry:F,maxDelay:se,resetTimeout:He}=l.retry,h=0,z=0,R=Be,oe=A>0?A:0;for(;h<=oe;)try{let u={signal:(await Ce(f,O,Ie,Fe,!!(O&&(!oe||He)))).signal,...f};if(await D(u,p.onRequest),await D(u,r.onRequest),i=a!=null&&a.request?await a.request(u):await fetch(u.url,u),i instanceof Response&&(i.config=u,i.data=await Te(i),!i.ok))throw new B(`${u.method} to ${u.url} failed! Status: ${i.status||null}`,u,i);await D(i,p.onResponse),await D(i,r.onResponse),S(f);let P=M(i,u);if(F&&h<A&&await F(P,h)){j(l,`Attempt ${h+1} failed response data check. Retry in ${R}ms.`),await _(R),R*=ne,R=Math.min(R,se),h++;continue}if(te&&(!re||!re(P,z))){z++,j(l,"Polling attempt "+z+"..."),await _(te);continue}return $&&q&&u.skipCache&&!u.skipCache(P,u)&&be(q,P),P}catch(G){let u=G;u.status=(u==null?void 0:u.status)||(i==null?void 0:i.status)||0,u.statusText=(u==null?void 0:u.statusText)||(i==null?void 0:i.statusText)||"",u.config=f,u.request=f,u.response=i;let P=M(i,f,u);if(h===A||!(J!=null&&J.includes(u.status))||!F||!await F(P,h)){if(Oe(u)||j(l,"FETCH ERROR",u),await D(u,p.onError),await D(u,r.onError),S(f),!Oe(u)||l.rejectCancelled){let ue=l.strategy;if(ue==="reject")return Promise.reject(u);ue==="silent"&&await new Promise(()=>null)}return P}if(u.status===429){let K=xe(P);K!==null&&(R=K)}j(l,`Attempt ${h+1} failed. Retry in ${R}ms.`),await _(R),R*=ne,R=Math.min(R,se),h++}return M(i,f)}}}var Oe=e=>e.name===N||e.name===fe,j=(e,...t)=>{let r=e.logger;r&&r.warn&&r.warn(...t)};function Se(e){let t=e.endpoints,r=v(e);function a(){return r.getInstance()}function n(m){return console.error(`Add ${m} to 'endpoints'.`),Promise.resolve(null)}async function s(m,c={}){let o=t[m]||{url:String(m)},p=o.url;if(p.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");return p.includes("://")?await Ae(p,c):await r.request(p,{...o,...c})}let d={config:e,endpoints:t,requestHandler:r,getInstance:a,request:s};return new Proxy(d,{get(m,c){return c in d?d[c]:t[c]?d.request.bind(null,c):n.bind(null,c)}})}async function Ae(e,t={}){return v(t).request(e)}export{Se as createApiFetcher,Ae as fetchf};
//# sourceMappingURL=index.mjs.map