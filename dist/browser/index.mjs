var He=Object.defineProperty;var Qe=(e,t,a)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var O=(e,t,a)=>Qe(e,typeof t!="symbol"?t+"":t,a);async function b(e,t){if(t){if(typeof t=="function"){let a=await t(e);a&&Object.assign(e,a)}else if(Array.isArray(t))for(let a of t){let r=await a(e);r&&Object.assign(e,r)}}}var k=class extends Error{constructor(a,r,s){super(a);O(this,"status");O(this,"statusText");O(this,"request");O(this,"config");O(this,"response");this.name="FetchError",this.message=a,this.status=(s==null?void 0:s.status)||0,this.statusText=(s==null?void 0:s.statusText)||"",this.request=r,this.config=r,this.response=s}};var M=class extends k{constructor(t,a,r){super(t,a,r),this.name="ResponseError"}};var L="application/",A=L+"json",pe="charset=utf-8",w="Content-Type",E="undefined",C="object",j="string",U="function",v="AbortError",de="TimeoutError",Re="CanceledError",H="GET",me="HEAD";var Pe=10,he=["__proto__","constructor","prototype"];function ae(e){return e instanceof URLSearchParams}function J(e){return e!==null&&typeof e===C}function ge(e){let t="";for(let a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t+=a+":"+e[a]);return t}function se(e){if(!e||typeof e!==C||Array.isArray(e))return e;let t={...e};return he.forEach(a=>{delete t[a]}),t}function ne(e){let t={},a=Object.keys(e);a.sort();for(let r=0,s=a.length;r<s;r++){let p=a[r];he.includes(p)||(t[p]=e[p])}return t}function ye(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function De(e,t){if(!t)return e;if(ae(t)){let f=t.toString();return ye(e,f)}let a=[],r=encodeURIComponent,s=(f,o)=>{o=typeof o===U?o():o,o=o===null||o===void 0?"":o,a[a.length]=r(f)+"="+r(o)},p=(f,o,P=0)=>{if(P>=Pe)return a;let d,h,D;if(f)if(Array.isArray(o))for(d=0,h=o.length;d<h;d++)p(f+"["+(typeof o[d]===C&&o[d]?d:"")+"]",o[d],P+1);else if(J(o))for(D in o)p(f+"["+D+"]",o[D],P+1);else s(f,o);else if(Array.isArray(o))for(d=0,h=o.length;d<h;d++)s(o[d].name,o[d].value);else for(D in o)p(D,o[D],P+1);return a},g=p("",t).join("&").replace(/%5B%5D/g,"[]");return ye(e,g)}function Te(e,t){return t?e.replace(/:\w+/g,a=>{let r=a.substring(1);return t[r]?encodeURIComponent(String(t[r])):a}):e}function Ee(e){let t=typeof e;return t===E||e===null?!1:t===j||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==E&&typeof globalThis.Buffer!==E&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(J(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===U))}async function re(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function oe(e,t=0){return t>=Pe?e:e&&J(e)&&typeof e.data!==E&&Object.keys(e).length===1?oe(e.data,t+1):e}function Ce(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((a,r)=>{t[r]=a});else if(J(e))for(let[a,r]of Object.entries(e))t[a.toLowerCase()]=r;return t}var Q=new Map;async function qe(e,t,a=0,r=!1,s=!0){let p=Date.now(),m=Q.get(e);if(m){let o=m[3],P=m[0],d=m[1];if(!o&&p-m[2]<a)return P;o&&P.abort(new DOMException("Aborted due to new request",v)),d!==null&&clearTimeout(d),Q.delete(e)}let g=new AbortController,f=s?setTimeout(()=>{let o=new DOMException(`${e.url} aborted due to timeout`,de);$(e,o)},t):null;return Q.set(e,[g,f,p,r]),g}async function $(e,t=null){let a=Q.get(e);if(a){let r=a[0],s=a[1];t&&!r.signal.aborted&&r.abort(t),s!==null&&clearTimeout(s),Q.delete(e)}}async function be(e){var r;if(!(e!=null&&e.body))return null;let t=String(((r=e.headers)==null?void 0:r.get(w))||"").split(";")[0],a;try{if(t.includes(A)||t.includes("+json"))a=await e.json();else if(t.includes("multipart/form-data"))a=await e.formData();else if(t.includes(L+"octet-stream"))a=await e.blob();else if(t.includes(L+"x-www-form-urlencoded"))a=await e.formData();else if(t.includes("text/"))a=await e.text();else try{a=await e.clone().json()}catch(s){a=await e.text()}}catch(s){a=null}return a}function z(e){let t=0;for(let a=0,r=e.length;a<r;a++){let s=e.charCodeAt(a);t=t*31+s|0}return String(t)}var ie=new Map;function we(e){let{url:t="",method:a=H,headers:r={},body:s="",mode:p="cors",credentials:m="include",cache:g="default",redirect:f="follow",referrer:o="",integrity:P=""}=e;if(g==="reload")return"";let d=ge(ne(r)),h="";if(s!==null)if(typeof s=="string")h=z(s);else if(s instanceof FormData)s.forEach((D,K)=>{h+=K+"="+D+"&"}),h=z(h);else if(typeof Blob!==E&&s instanceof Blob||typeof File!==E&&s instanceof File)h="BF"+s.size+s.type;else if(s instanceof ArrayBuffer||ArrayBuffer.isView(s))h="AB"+s.byteLength;else{let D=typeof s===C?ne(s):String(s);h=z(JSON.stringify(D))}return(a+t+p+m+g+f+o+P+d+h).replace(/[^\w-_]/g,"")}function Ne(e,t){return t?Date.now()-e>t*1e3:!1}function xe(e,t){let a=ie.get(e);if(a){if(!Ne(a.timestamp,t))return a;ie.delete(e)}return null}function Oe(e,t,a=!1){ie.set(e,{data:t,isLoading:a,timestamp:Date.now()})}var ue={method:H,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:A+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function G(e){let t=se(e),a={...ue,...t},r=(n,u,c,R)=>{R[n]&&(u[n]={...c[n],...R[n]})};r("retry",a,ue,t),r("headers",a,ue,t);let s=(n,u)=>typeof n[u]!==E?n[u]:a[u],p=s(t,"fetcher"),m=(p==null?void 0:p.create(a))||null,g=()=>m,f=(n,...u)=>{let c=s(n,"logger");c!=null&&c.warn&&c.warn(...u)},o=(n,u,c)=>{if(!c&&["PUT","DELETE"].includes(u))return;let R=A+";"+pe;n instanceof Headers?n.has(w)||n.set(w,R):typeof n===C&&!Array.isArray(n)&&!n[w]&&(n[w]=R)},P=(n,u)=>{let c=s(u,"method").toUpperCase(),R=c===H||c===me,i=Te(n,s(u,"urlPathParams")),y=s(u,"params"),N=s(u,"body")||s(u,"data"),T;R||(T=N);let S=s(u,"headers");o(S,c,T);let _=s(u,"withCredentials")?"include":s(u,"credentials"),x=y?De(i,y):i,q=x.includes("://")?"":s(u,"baseURL")||s(u,"apiUrl");return T&&typeof T!==j&&!ae(T)&&Ee(T)&&(T=JSON.stringify(T)),{...u,credentials:_,body:T,method:c,headers:S,url:q+x}},d=async(n,u)=>{D(n)||f(u,"API ERROR",n),await b(n,u==null?void 0:u.onError),await b(n,a==null?void 0:a.onError)},h=async(n,u,c)=>{let R=D(n),i=s(c,"strategy"),y=s(c,"rejectCancelled");if(!(R&&!y)){if(i==="silent")await new Promise(()=>null);else if(i==="reject")return Promise.reject(n)}return V(u,c,n)},D=n=>n.name===v||n.name===Re,K=async(n,u=null)=>{let c=se(u||{}),R={...a,...c};r("retry",R,a,c),r("headers",R,a,c);let i=null,y=P(n,R),{timeout:N,cancellable:T,dedupeTime:S,pollingInterval:Y,shouldStopPolling:_,cacheTime:x,cacheKey:W}=R,q;if(W?q=W(y):q=we(y),x&&q){let B=R.cacheBuster;if(!B||!B(y)){let l=xe(q,x);if(l)return l.data}}let{retries:X=0,delay:Ie,backoff:Be,retryOn:Z,shouldRetry:le,maxDelay:Ae,resetTimeout:Ue}=R.retry,F=0,ee=0,I=Ie,ce=X>0?X:0;for(;F<=ce;)try{let l={signal:(await qe(y,N,S,T,!!(N&&(!ce||Ue)))).signal,...y};if(await b(l,c==null?void 0:c.onRequest),await b(l,a==null?void 0:a.onRequest),p!==null&&m!==null&&typeof m.request===U?i=await m.request(l):i=await fetch(l.url,l),i instanceof Response&&(i.config=l,i.data=await be(i),!i.ok))throw new M(`${l.url} failed! Status: ${i.status||null}`,l,i);if(await b(i,c==null?void 0:c.onResponse),await b(i,a==null?void 0:a.onResponse),$(y),Y&&(!_||!_(i,ee))){ee++,f(l,"Polling attempt "+ee+"..."),await re(Y);continue}let te=V(i,l);if(x&&q){let fe=l.skipCache;(!fe||!fe(te,l))&&Oe(q,te)}return te}catch(B){let l=B;if(l.status=(l==null?void 0:l.status)||(i==null?void 0:i.status)||0,l.statusText=(l==null?void 0:l.statusText)||(i==null?void 0:i.statusText)||"",l.config=y,l.request=y,l.response=i,F===X||!(!le||await le(l,F))||!(Z!=null&&Z.includes(l.status)))return await d(l,y),$(y),h(l,i,y);f(R,`Attempt ${F+1} failed. Retry in ${I}ms.`),await re(I),I*=Be,I=Math.min(I,Ae),F++}return V(i,y)},V=(n,u,c=null)=>{let R=s(u,"defaultResponse");if(!n)return{ok:!1,error:c,data:R,headers:null,config:u};let i=n==null?void 0:n.data;return(i==null||typeof i===C&&Object.keys(i).length===0)&&(i=R),s(u,"flattenResponse")&&(n.data=oe(i)),n instanceof Response?{body:n.body,bodyUsed:n.bodyUsed,ok:n.ok,redirected:n.redirected,type:n.type,url:n.url,status:n.status,statusText:n.statusText,blob:()=>n.blob(),json:()=>n.json(),text:()=>n.text(),clone:()=>n.clone(),arrayBuffer:()=>n.arrayBuffer(),formData:()=>n.formData(),bytes:()=>n.bytes(),error:c,data:i,headers:Ce(n.headers),config:u}:n};return{getInstance:g,buildConfig:P,config:a,request:K}}function ft(e){let t=e.endpoints,a=G(e);function r(){return a.getInstance()}function s(g){return console.error(`Add ${g} to 'endpoints'.`),Promise.resolve(null)}async function p(g,f={}){let o=t[g]||{url:String(g)},P=o.url;if(P.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");return P.includes("://")?await Fe(P,f):await a.request(P,{...o,...f})}let m={config:e,endpoints:t,requestHandler:a,getInstance:r,request:p};return new Proxy(m,{get(g,f){return f in m?m[f]:t[f]?m.request.bind(null,f):s.bind(null,f)}})}async function Fe(e,t={}){return G(t).request(e,t)}export{ft as createApiFetcher,Fe as fetchf};
//# sourceMappingURL=index.mjs.map