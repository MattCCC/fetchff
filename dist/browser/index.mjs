var Se=Object.defineProperty;var Me=(e,t,n)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var U=(e,t,n)=>Me(e,typeof t!="symbol"?t+"":t,n);async function w(e,t){if(t){if(typeof t=="function"){let n=await t(e);n&&Object.assign(e,n)}else if(Array.isArray(t))for(let n of t){let r=await n(e);r&&Object.assign(e,r)}}}var N=class extends Error{constructor(n,r,a){super(n);this.request=r;this.response=a;U(this,"status");U(this,"statusText");U(this,"config");this.name="FetchError",this.status=(a==null?void 0:a.status)||0,this.statusText=(a==null?void 0:a.statusText)||"",this.config=r}};var _=class extends N{constructor(t,n,r){super(t,n,r),this.name="ResponseError"}};var S="application/",A=S+"json",pe="charset=utf-8",b="Content-Type",C="undefined",P="object",M="string",Y="function",k="AbortError",me="TimeoutError",de="CanceledError",q="GET",Re="HEAD";var Pe=10,he=["__proto__","constructor","prototype"];function W(e){return e instanceof URLSearchParams}function L(e){return e!==null&&typeof e===P}function ge(e){let t="";for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t+=n+":"+e[n]);return t}function X(e){if(!e||typeof e!==P||Array.isArray(e))return e;let t={...e};return he.forEach(n=>{delete t[n]}),t}function Z(e){let t={},n=Object.keys(e);n.sort();for(let r=0,a=n.length;r<a;r++){let o=n[r];he.includes(o)||(t[o]=e[o])}return t}function ye(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function De(e,t){if(!t)return e;if(W(t)){let c=t.toString();return ye(e,c)}let n=[],r=encodeURIComponent,a=(c,u)=>{u=typeof u===Y?u():u,u=u===null||u===void 0?"":u,n[n.length]=r(c)+"="+r(u)},o=(c,u,p=0)=>{if(p>=Pe)return n;let i,s,f;if(c)if(Array.isArray(u))for(i=0,s=u.length;i<s;i++)o(c+"["+(typeof u[i]===P&&u[i]?i:"")+"]",u[i],p+1);else if(L(u))for(f in u)o(c+"["+f+"]",u[f],p+1);else a(c,u);else if(Array.isArray(u))for(i=0,s=u.length;i<s;i++)a(u[i].name,u[i].value);else for(f in u)o(f,u[f],p+1);return n},m=o("",t).join("&").replace(/%5B%5D/g,"[]");return ye(e,m)}function Ce(e,t){if(!t||e.indexOf(":")===-1)return e;let n=t;return e.replace(/:([a-zA-Z0-9_]+)/g,(r,a)=>{if(Object.prototype.hasOwnProperty.call(n,a)){let o=n[a];if(o!=null)return encodeURIComponent(String(o))}return r})}function Ee(e){let t=typeof e;return t===C||e===null?!1:t===M||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==C&&typeof globalThis.Buffer!==C&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(L(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===Y))}async function O(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function ee(e,t=0){return t>=Pe?e:e&&L(e)&&typeof e.data!==C&&Object.keys(e).length===1?ee(e.data,t+1):e}function Te(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((n,r)=>{t[r]=n});else if(L(e))for(let[n,r]of Object.entries(e))t[n.toLowerCase()]=r;return t}var E=new Map;async function we(e,t,n,r=0,a=!1,o=!0){if(!e)return new AbortController;let d=Date.now(),m=E.get(e);if(m){let p=m[3],i=m[0],s=m[1];if(!p&&d-m[2]<r)return i;p&&i.abort(new DOMException("Aborted due to new request",k)),s!==null&&clearTimeout(s),E.delete(e)}let c=new AbortController,u=o?setTimeout(()=>{let p=new DOMException(`${t} aborted due to timeout`,me);j(e,p)},n):null;return E.set(e,[c,u,d,a]),c}async function j(e,t=null){if(!e)return;let n=E.get(e);if(n){let r=n[0],a=n[1];t&&!r.signal.aborted&&r.abort(t),a!==null&&clearTimeout(a),E.delete(e)}}function be(e,t){let n=E.get(e);n&&(n[4]=t,E.set(e,n))}function qe(e,t){let n=E.get(e);return n&&n[4]&&Date.now()-n[2]<t?n[4]:null}async function Oe(e){var a;if(!(e!=null&&e.body))return null;let t=(a=e.headers)==null?void 0:a.get(b);t?t=t.toLowerCase().trim():t="";let n=t.split(";",1)[0],r;try{if(n.includes(A)||n.includes("+json"))r=await e.json();else if(n.includes("multipart/form-data"))r=await e.formData();else if(n.includes(S+"octet-stream"))r=await e.blob();else if(n.includes(S+"x-www-form-urlencoded"))r=await e.formData();else if(n.startsWith("text/"))r=await e.text();else try{r=await e.clone().json()}catch(o){r=await e.text()}}catch(o){r=null}return r}var v=(e,t,n=null)=>{var o;let r=(o=t.defaultResponse)!=null?o:null;if(!e)return{ok:!1,error:n,data:r,headers:null,config:t};let a=e.data;return(a==null||typeof a===P&&Object.keys(a).length===0)&&(a=r),t.flattenResponse&&(e.data=ee(a)),e instanceof Response?{body:e.body,bodyUsed:e.bodyUsed,ok:e.ok,redirected:e.redirected,type:e.type,url:e.url,status:e.status,statusText:e.statusText,blob:()=>e.blob(),json:()=>e.json(),text:()=>e.text(),clone:()=>e.clone(),arrayBuffer:()=>e.arrayBuffer(),formData:()=>e.formData(),bytes:()=>e.bytes(),error:n,data:a,headers:Te(e.headers),config:t}:e};function I(e){let t=0;for(let n=0,r=e.length;n<r;n++){let a=e.charCodeAt(n);t=t*31+a|0}return String(t)}var te=new Map,$="|",J=64;function xe(e){let{url:t="",method:n=q,headers:r=null,body:a=void 0,mode:o="cors",credentials:d="same-origin",cache:m="default",redirect:c="follow",referrer:u="about:client",integrity:p=""}=e;if(m==="reload")return"";let i="";if(r){let f=r instanceof Headers?Object.fromEntries(r.entries()):r;i=ge(Z(f)),i.length>J&&(i=I(i))}let s="";if(a)if(typeof a=="string")s=a.length<J?a:I(a);else if(a instanceof FormData)a.forEach((f,x)=>{s+=x+"="+f+"&"}),s.length>J&&(s=I(s));else if(typeof Blob!==C&&a instanceof Blob||typeof File!==C&&a instanceof File)s="BF"+a.size+a.type;else if(a instanceof ArrayBuffer||ArrayBuffer.isView(a))s="AB"+a.byteLength;else{let f=typeof a===P?JSON.stringify(Z(a)):String(a);s=f.length>J?I(f):f}return(n+$+t+$+o+d+m+c+u+p+$+i+$+s).replace(/[^\w\-_|]/g,"")}function ke(e,t){return t?Date.now()-e>t*1e3:!1}function Le(e,t){let n=te.get(e);if(n){if(!ke(n.timestamp,t))return n;je(e)}return null}function Fe(e,t,n=!1){te.set(e,{data:t,isLoading:n,timestamp:Date.now()})}function je(e){te.delete(e)}function Ae(e,t,n,r){if(!t||!e||n!=null&&n(r))return null;let a=Le(e,t);return a?a.data:null}var z={method:q,strategy:"reject",timeout:3e4,dedupeTime:0,defaultResponse:null,headers:{Accept:A+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}},Ie=(e,t)=>{var i,s,f;let n=((i=t.method)!=null?i:q).toUpperCase(),r=n===q||n===Re,a=Ce(e,t.urlPathParams),o;r||(o=(s=t.body)!=null?s:t.data),ve(n,t.headers,o);let d=t.withCredentials?"include":t.credentials,m=t.params,c=m?De(a,m):a,p=c.includes("://")?"":(f=t.baseURL)!=null?f:t.apiUrl;return o&&typeof o!==M&&!W(o)&&Ee(o)&&(o=JSON.stringify(o)),{...t,url:p+c,method:n,credentials:d,body:o}},ve=(e,t,n)=>{if(!t||!n&&["PUT","DELETE"].includes(e))return;let r=A+";"+pe;t instanceof Headers?t.has(b)||t.set(b,r):typeof t===P&&!Array.isArray(t)&&!t[b]&&(t[b]=r)},T=(e,t,n,r)=>{r[e]&&(t[e]={...n[e],...r[e]})};function He(e){var a;let t=(a=e==null?void 0:e.headers)==null?void 0:a["retry-after"];if(!t)return null;let n=Number(t);if(!isNaN(n)&&n>=0)return n*1e3;let r=new Date(t);if(!isNaN(r.getTime())){let o=r.getTime()-Date.now();return o>0?o:0}return null}async function Be(e,t,n,r=0,a=0){let o=0,d;for(;(r===0||o<r)&&(a>0&&await O(a),d=await e(),o++,!(r>0&&o>=r||!t||n&&n(d,o)));)await O(t);return d}function G(e){var d,m;let t=e?X(e):{},n={...z,...t};T("retry",n,z,t),T("headers",n,z,t);let r=(m=(d=t.fetcher)==null?void 0:d.create)==null?void 0:m.call(d,n);return{getInstance:()=>r||null,config:n,request:async(c,u=null)=>{let p=u?X(u):{},i={...n,...p};T("retry",i,n,p),T("headers",i,n,p);let s=null,f=Ie(c,i),{timeout:x,cancellable:re,dedupeTime:F,cacheTime:H,cacheKey:ae,pollingInterval:se=0}=i,y=null;if((H||F||re||x)&&(y=ae?ae(f):xe(f)),H){let g=Ae(y,H,i.cacheBuster,f);if(g)return g}if(y&&F){let g=qe(y,F);if(g)return await g}let oe=async()=>{let{retries:g=0,delay:Ne,backoff:ue,retryOn:K,shouldRetry:B,maxDelay:le,resetTimeout:_e}=i.retry,h=0,R=Ne||0,Q=g>0?g:0;for(;h<=Q;)try{let l={signal:(await we(y,f.url,x,F,re,!!(x&&(!Q||_e)))).signal,...f};if(await w(l,p.onRequest),await w(l,n.onRequest),s=r!=null&&r.request?await r.request(l):await fetch(l.url,l),s instanceof Response&&(s.config=l,s.data=await Oe(s),!s.ok))throw new _(`${l.method} to ${l.url} failed! Status: ${s.status||null}`,l,s);await w(s,p.onResponse),await w(s,n.onResponse),j(y);let D=v(s,l);if(B&&h<Q&&await B(D,h)){ne(i,`Attempt ${h+1} failed response data check. Retry in ${R}ms.`),await O(R),R*=ue||1,R=Math.min(R,le||R),h++;continue}return H&&y&&(!l.skipCache||!l.skipCache(D,l))&&Fe(y,D),D}catch(ce){let l=ce;l.status=(l==null?void 0:l.status)||(s==null?void 0:s.status)||0,l.statusText=(l==null?void 0:l.statusText)||(s==null?void 0:s.statusText)||"",l.config=f,l.request=f,l.response=s;let D=v(s,f,l);if(h===Q||!(K!=null&&K.includes(l.status))||!B||!await B(D,h)){if(Qe(l)||ne(i,"FETCH ERROR",l),await w(l,p.onError),await w(l,n.onError),j(y),!Qe(l)||i.rejectCancelled){let fe=i.strategy;if(fe==="reject")return Promise.reject(l);fe==="silent"&&await new Promise(()=>null)}return D}if(l.status===429){let V=He(D);V!==null&&(R=V)}ne(i,`Attempt ${h+1} failed. Retry in ${R}ms.`),await O(R),R*=ue||1,R=Math.min(R,le||R),h++}return v(s,f)},ie=se>0?Be(oe,se,i.shouldStopPolling,i.maxPollingAttempts,i.pollingDelay):oe();return y&&F&&be(y,ie),ie}}}var Qe=e=>e.name===k||e.name===de,ne=(e,...t)=>{let n=e.logger;n&&n.warn&&n.warn(...t)};function $e(e){let t=e.endpoints,n=G(e);function r(){return n.getInstance()}function a(m){return console.error(`Add ${m} to 'endpoints'.`),Promise.resolve(null)}async function o(m,c={}){let u=t[m]||{url:String(m)},p=u.url;if(p.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");if(p.includes("://"))return await Ue(p,c);let s={...u,...c};return T("retry",s,u,c),T("headers",s,u,c),await n.request(p,s)}let d={config:e,endpoints:t,requestHandler:n,getInstance:r,request:o};return new Proxy(d,{get(m,c){return c in d?d[c]:t[c]?d.request.bind(null,c):a.bind(null,c)}})}async function Ue(e,t={}){return G(t).request(e)}export{$e as createApiFetcher,Ue as fetchf};
//# sourceMappingURL=index.mjs.map