var we=Object.defineProperty;var Oe=(e,t,a)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var w=(e,t,a)=>Oe(e,typeof t!="symbol"?t+"":t,a);async function C(e,t){if(t){if(typeof t=="function"){let a=await t(e);a&&Object.assign(e,a)}else if(Array.isArray(t))for(let a of t){let n=await a(e);n&&Object.assign(e,n)}}}var _=class extends Error{constructor(a,n,r){super(a);w(this,"status");w(this,"statusText");w(this,"request");w(this,"config");w(this,"response");this.name="FetchError",this.message=a,this.status=(r==null?void 0:r.status)||0,this.statusText=(r==null?void 0:r.statusText)||"",this.request=n,this.config=n,this.response=r}};var M=class extends _{constructor(t,a,n){super(t,a,n),this.name="ResponseError"}};var L="application/",H=L+"json",ue="charset=utf-8",b="Content-Type",T="undefined",E="object",j="string",v="AbortError",le="TimeoutError",ce="CanceledError",Q="GET",fe="HEAD";function Z(e){return e instanceof URLSearchParams}function pe(e){let t="";for(let a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t+=a+":"+e[a]);return t}function ee(e){let t={},a=Object.keys(e);a.sort();for(let n=0,r=a.length;n<r;n++){let R=a[n];t[R]=e[R]}return t}function de(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function Re(e,t){if(!t)return e;if(Z(t)){let f=t.toString();return de(e,f)}let a=[],n=encodeURIComponent,r=(f,o)=>{o=typeof o=="function"?o():o,o=o===null||o===void 0?"":o,a[a.length]=n(f)+"="+n(o)},R=(f,o)=>{let d,D,m;if(f)if(Array.isArray(o))for(d=0,D=o.length;d<D;d++)R(f+"["+(typeof o[d]===E&&o[d]?d:"")+"]",o[d]);else if(typeof o===E&&o!==null)for(m in o)R(f+"["+m+"]",o[m]);else r(f,o);else if(Array.isArray(o))for(d=0,D=o.length;d<D;d++)r(o[d].name,o[d].value);else for(m in o)R(m,o[m]);return a},P=R("",t).join("&").replace(/%5B%5D/g,"[]");return de(e,P)}function me(e,t){return t?e.replace(/:\w+/g,a=>{let n=a.substring(1);return t[n]?String(t[n]):a}):e}function ye(e){let t=typeof e;if(t===T||e===null)return!1;if(t===j||t==="number"||t==="boolean"||Array.isArray(e))return!0;if(typeof globalThis!==T&&typeof globalThis.Buffer!==T&&globalThis.Buffer.isBuffer(e)||e instanceof Date)return!1;if(t===E){let a=Object.getPrototypeOf(e);if(a===Object.prototype||a===null||typeof e.toJSON=="function")return!0}return!1}async function te(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function ae(e){return e&&typeof e===E&&typeof e.data!==T&&Object.keys(e).length===1?ae(e.data):e}function Pe(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((a,n)=>{t[n]=a});else if(typeof e===E&&e!==null)for(let[a,n]of Object.entries(e))t[a.toLowerCase()]=n;return t}var U=new Map;async function he(e,t,a=0,n=!1,r=!0){let R=Date.now(),h=U.get(e);if(h){let o=h[3],d=h[0],D=h[1];if(!o&&R-h[2]<a)return d;o&&d.abort(new DOMException("Aborted due to new request",v)),D!==null&&clearTimeout(D),U.delete(e)}let P=new AbortController,f=r?setTimeout(()=>{let o=new DOMException(`${e.url} aborted due to timeout`,le);J(e,o)},t):null;return U.set(e,[P,f,R,n]),P}async function J(e,t=null){let a=U.get(e);if(a){let n=a[0],r=a[1];t&&!n.signal.aborted&&n.abort(t),r!==null&&clearTimeout(r),U.delete(e)}}async function De(e){var n;if(!(e!=null&&e.body))return null;let t=String(((n=e.headers)==null?void 0:n.get(b))||"").split(";")[0],a;try{if(t.includes(H)||t.includes("+json"))a=await e.json();else if(t.includes("multipart/form-data"))a=await e.formData();else if(t.includes(L+"octet-stream"))a=await e.blob();else if(t.includes(L+"x-www-form-urlencoded"))a=await e.formData();else if(t.includes("text/"))a=await e.text();else try{a=await e.clone().json()}catch(r){a=await e.text()}}catch(r){a=null}return a}function $(e){let t=0;for(let a=0,n=e.length;a<n;a++){let r=e.charCodeAt(a);t=t*31+r|0}return String(t)}var se=new Map;function ge(e){let{url:t="",method:a=Q,headers:n={},body:r="",mode:R="cors",credentials:h="include",cache:P="default",redirect:f="follow",referrer:o="",integrity:d=""}=e;if(P==="reload")return"";let D=pe(ee(n)),m="";if(r!==null)if(typeof r=="string")m=$(r);else if(r instanceof FormData)r.forEach((O,B)=>{m+=B+"="+O+"&"}),m=$(m);else if(typeof Blob!==T&&r instanceof Blob||typeof File!==T&&r instanceof File)m="BF"+r.size+r.type;else if(r instanceof ArrayBuffer||ArrayBuffer.isView(r))m="AB"+r.byteLength;else{let O=typeof r===E?ee(r):String(r);m=$(JSON.stringify(O))}return a+t+R+h+P+f+o+d+D+m}function Be(e,t){return t?Date.now()-e>t*1e3:!1}function Ee(e,t){let a=se.get(e);if(a){if(!Be(a.timestamp,t))return a;se.delete(e)}return null}function Te(e,t,a=!1){se.set(e,{data:t,isLoading:a,timestamp:Date.now()})}var ne={method:Q,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:H+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function G(e){let t={...ne,...e},a=(s,u,c,p)=>{p[s]&&(u[s]={...c[s],...p[s]})};a("retry",t,ne,e),a("headers",t,ne,e);let n=(s,u)=>typeof s[u]!==T?s[u]:t[u],r=n(e,"fetcher"),R=(r==null?void 0:r.create(t))||null,h=()=>R,P=(s,...u)=>{let c=n(s,"logger");c!=null&&c.warn&&c.warn(...u)},f=(s,u,c)=>{if(!(!c&&["PUT","DELETE"].includes(u))){let p=H+";"+ue;s instanceof Headers?s.has(b)||s.set(b,p):typeof s===E&&!Array.isArray(s)&&!s[b]&&(s[b]=p)}},o=(s,u)=>{let c=n(u,"method").toUpperCase(),p=c===Q||c===fe,i=me(s,n(u,"urlPathParams")),y=n(u,"params"),N=n(u,"body")||n(u,"data"),g;p||(g=N);let S=n(u,"headers");f(S,c,g);let k=n(u,"withCredentials")?"include":n(u,"credentials"),x=y?Re(i,y):i,q=x.includes("://")?"":n(u,"baseURL")||n(u,"apiUrl");return g&&typeof g!==j&&!Z(g)&&ye(g)&&(g=JSON.stringify(g)),{...u,credentials:k,body:g,method:c,headers:S,url:q+x}},d=async(s,u)=>{m(s)||P(u,"API ERROR",s),await C(s,u==null?void 0:u.onError),await C(s,t==null?void 0:t.onError)},D=async(s,u,c)=>{let p=m(s),i=n(c,"strategy"),y=n(c,"rejectCancelled");if(!(p&&!y)){if(i==="silent")await new Promise(()=>null);else if(i==="reject")return Promise.reject(s)}return B(u,c,s)},m=s=>s.name===v||s.name===ce,O=async(s,u=null)=>{let c=u||{},p={...t,...c};a("retry",p,t,c),a("headers",p,t,c);let i=null,y=o(s,p),{timeout:N,cancellable:g,dedupeTime:S,pollingInterval:z,shouldStopPolling:k,cacheTime:x,cacheKey:K}=p,q;if(K?q=K(y):q=ge(y),x&&q){let A=p.cacheBuster;if(!A||!A(y)){let l=Ee(q,x);if(l)return l.data}}let{retries:V=0,delay:qe,backoff:Ce,retryOn:Y,shouldRetry:re,maxDelay:be,resetTimeout:xe}=p.retry,F=0,W=0,I=qe,oe=V>0?V:0;for(;F<=oe;)try{let l={signal:(await he(y,N,S,g,!!(N&&(!oe||xe)))).signal,...y};if(await C(l,c==null?void 0:c.onRequest),await C(l,t==null?void 0:t.onRequest),r!==null&&R!==null?i=await R.request(l):i=await fetch(l.url,l),i instanceof Response&&(i.config=l,i.data=await De(i),!i.ok))throw new M(`${l.url} failed! Status: ${i.status||null}`,l,i);if(await C(i,c==null?void 0:c.onResponse),await C(i,t==null?void 0:t.onResponse),J(y),z&&(!k||!k(i,W))){W++,P(l,"Polling attempt "+W+"..."),await te(z);continue}let X=B(i,l);if(x&&q){let ie=l.skipCache;(!ie||!ie(X,l))&&Te(q,X)}return X}catch(A){let l=A;if(l.status=(l==null?void 0:l.status)||(i==null?void 0:i.status)||0,l.statusText=(l==null?void 0:l.statusText)||(i==null?void 0:i.statusText)||"",l.config=y,l.request=y,l.response=i,F===V||!(!re||await re(l,F))||!(Y!=null&&Y.includes(l.status)))return await d(l,y),J(y),D(l,i,y);P(p,`Attempt ${F+1} failed. Retry in ${I}ms.`),await te(I),I*=Ce,I=Math.min(I,be),F++}return B(i,y)},B=(s,u,c=null)=>{let p=n(u,"defaultResponse");if(!s)return{ok:!1,error:c,data:p,headers:null,config:u};let i=s==null?void 0:s.data;return(i==null||typeof i===E&&Object.keys(i).length===0)&&(i=p),n(u,"flattenResponse")&&(s.data=ae(i)),s instanceof Response?{body:s.body,bodyUsed:s.bodyUsed,formData:s.formData,ok:s.ok,redirected:s.redirected,type:s.type,url:s.url,status:s.status,statusText:s.statusText,blob:s.blob.bind(s),json:s.json.bind(s),text:s.text.bind(s),clone:s.clone.bind(s),arrayBuffer:s.arrayBuffer.bind(s),error:c,data:i,headers:Pe(s.headers),config:u}:s};return{getInstance:h,buildConfig:o,config:e,request:O}}function st(e){let t=e.endpoints,a=G(e);function n(){return a.getInstance()}function r(P){return console.error(`Add ${P} to 'endpoints'.`),Promise.resolve(null)}async function R(P,f={}){let o=t[P]||{url:P};return await a.request(o.url,{...o,...f})}let h={config:e,endpoints:t,requestHandler:a,getInstance:n,request:R};return new Proxy(h,{get(P,f){return f in h?h[f]:t[f]?h.request.bind(null,f):r.bind(null,f)}})}async function ot(e,t={}){return G(t).request(e,t)}export{st as createApiFetcher,ot as fetchf};
//# sourceMappingURL=index.mjs.map