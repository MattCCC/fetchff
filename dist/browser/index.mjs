var He=Object.defineProperty;var Qe=(e,t,a)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var B=(e,t,a)=>Qe(e,typeof t!="symbol"?t+"":t,a);async function x(e,t){if(t){if(typeof t=="function"){let a=await t(e);a&&Object.assign(e,a)}else if(Array.isArray(t))for(let a of t){let r=await a(e);r&&Object.assign(e,r)}}}var L=class extends Error{constructor(a,r,s){super(a);B(this,"status");B(this,"statusText");B(this,"request");B(this,"config");B(this,"response");this.name="FetchError",this.message=a,this.status=(s==null?void 0:s.status)||0,this.statusText=(s==null?void 0:s.statusText)||"",this.request=r,this.config=r,this.response=s}};var j=class extends L{constructor(t,a,r){super(t,a,r),this.name="ResponseError"}};var v="application/",U=v+"json",Re="charset=utf-8",O="Content-Type",C="undefined",b="object",$="string",H="function",J="AbortError",me="TimeoutError",ye="CanceledError",Q="GET",Pe="HEAD";var ge=10,De=["__proto__","constructor","prototype"];function ne(e){return e instanceof URLSearchParams}function z(e){return e!==null&&typeof e===b}function Te(e){let t="";for(let a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t+=a+":"+e[a]);return t}function re(e){if(!e||typeof e!==b||Array.isArray(e))return e;let t={...e};return De.forEach(a=>{delete t[a]}),t}function oe(e){let t={},a=Object.keys(e);a.sort();for(let r=0,s=a.length;r<s;r++){let d=a[r];De.includes(d)||(t[d]=e[d])}return t}function he(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function Ee(e,t){if(!t)return e;if(ne(t)){let f=t.toString();return he(e,f)}let a=[],r=encodeURIComponent,s=(f,o)=>{o=typeof o===H?o():o,o=o===null||o===void 0?"":o,a[a.length]=r(f)+"="+r(o)},d=(f,o,P=0)=>{if(P>=ge)return a;let R,h,D;if(f)if(Array.isArray(o))for(R=0,h=o.length;R<h;R++)d(f+"["+(typeof o[R]===b&&o[R]?R:"")+"]",o[R],P+1);else if(z(o))for(D in o)d(f+"["+D+"]",o[D],P+1);else s(f,o);else if(Array.isArray(o))for(R=0,h=o.length;R<h;R++)s(o[R].name,o[R].value);else for(D in o)d(D,o[D],P+1);return a},g=d("",t).join("&").replace(/%5B%5D/g,"[]");return he(e,g)}function Ce(e,t){return t?e.replace(/:\w+/g,a=>{let r=a.substring(1);return t[r]?encodeURIComponent(String(t[r])):a}):e}function qe(e){let t=typeof e;return t===C||e===null?!1:t===$||t==="number"||t==="boolean"||Array.isArray(e)?!0:typeof globalThis!==C&&typeof globalThis.Buffer!==C&&globalThis.Buffer.isBuffer(e)||e instanceof Date?!1:!!(z(e)&&(Object.getPrototypeOf(e)===Object.prototype||typeof e.toJSON===H))}async function G(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function ie(e,t=0){return t>=ge?e:e&&z(e)&&typeof e.data!==C&&Object.keys(e).length===1?ie(e.data,t+1):e}function be(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((a,r)=>{t[r]=a});else if(z(e))for(let[a,r]of Object.entries(e))t[a.toLowerCase()]=r;return t}var N=new Map;async function we(e,t,a=0,r=!1,s=!0){let d=Date.now(),y=N.get(e);if(y){let o=y[3],P=y[0],R=y[1];if(!o&&d-y[2]<a)return P;o&&P.abort(new DOMException("Aborted due to new request",J)),R!==null&&clearTimeout(R),N.delete(e)}let g=new AbortController,f=s?setTimeout(()=>{let o=new DOMException(`${e.url} aborted due to timeout`,me);K(e,o)},t):null;return N.set(e,[g,f,d,r]),g}async function K(e,t=null){let a=N.get(e);if(a){let r=a[0],s=a[1];t&&!r.signal.aborted&&r.abort(t),s!==null&&clearTimeout(s),N.delete(e)}}async function xe(e){var r;if(!(e!=null&&e.body))return null;let t=String(((r=e.headers)==null?void 0:r.get(O))||"").split(";")[0],a;try{if(t.includes(U)||t.includes("+json"))a=await e.json();else if(t.includes("multipart/form-data"))a=await e.formData();else if(t.includes(v+"octet-stream"))a=await e.blob();else if(t.includes(v+"x-www-form-urlencoded"))a=await e.formData();else if(t.includes("text/"))a=await e.text();else try{a=await e.clone().json()}catch(s){a=await e.text()}}catch(s){a=null}return a}function V(e){let t=0;for(let a=0,r=e.length;a<r;a++){let s=e.charCodeAt(a);t=t*31+s|0}return String(t)}var ue=new Map;function Oe(e){let{url:t="",method:a=Q,headers:r={},body:s="",mode:d="cors",credentials:y="include",cache:g="default",redirect:f="follow",referrer:o="",integrity:P=""}=e;if(g==="reload")return"";let R=Te(oe(r)),h="";if(s!==null)if(typeof s=="string")h=V(s);else if(s instanceof FormData)s.forEach((D,W)=>{h+=W+"="+D+"&"}),h=V(h);else if(typeof Blob!==C&&s instanceof Blob||typeof File!==C&&s instanceof File)h="BF"+s.size+s.type;else if(s instanceof ArrayBuffer||ArrayBuffer.isView(s))h="AB"+s.byteLength;else{let D=typeof s===b?oe(s):String(s);h=V(JSON.stringify(D))}return(a+t+d+y+g+f+o+P+R+h).replace(/[^\w-_]/g,"")}function Ne(e,t){return t?Date.now()-e>t*1e3:!1}function Fe(e,t){let a=ue.get(e);if(a){if(!Ne(a.timestamp,t))return a;ue.delete(e)}return null}function Be(e,t,a=!1){ue.set(e,{data:t,isLoading:a,timestamp:Date.now()})}var le={method:Q,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:U+", text/plain, */*","Accept-Encoding":"gzip, deflate, br"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function Y(e){let t=re(e),a={...le,...t},r=(n,u,c,p)=>{p[n]&&(u[n]={...c[n],...p[n]})};r("retry",a,le,t),r("headers",a,le,t);let s=(n,u)=>typeof n[u]!==C?n[u]:a[u],d=s(t,"fetcher"),y=(d==null?void 0:d.create(a))||null,g=()=>y,f=(n,...u)=>{let c=s(n,"logger");c!=null&&c.warn&&c.warn(...u)},o=(n,u,c)=>{if(!c&&["PUT","DELETE"].includes(u))return;let p=U+";"+Re;n instanceof Headers?n.has(O)||n.set(O,p):typeof n===b&&!Array.isArray(n)&&!n[O]&&(n[O]=p)},P=(n,u)=>{let c=s(u,"method").toUpperCase(),p=c===Q||c===Pe,i=Ce(n,s(u,"urlPathParams")),m=s(u,"params"),S=s(u,"body")||s(u,"data"),T;p||(T=S);let _=s(u,"headers");o(_,c,T);let k=s(u,"withCredentials")?"include":s(u,"credentials"),F=m?Ee(i,m):i,w=F.includes("://")?"":s(u,"baseURL")||s(u,"apiUrl");return T&&typeof T!==$&&!ne(T)&&qe(T)&&(T=JSON.stringify(T)),{...u,credentials:k,body:T,method:c,headers:_,url:w+F}},R=async(n,u)=>{D(n)||f(u,"API ERROR",n),await x(n,u==null?void 0:u.onError),await x(n,a==null?void 0:a.onError)},h=async(n,u,c)=>{let p=D(n),i=s(c,"strategy"),m=s(c,"rejectCancelled");if(!(p&&!m)){if(i==="silent")await new Promise(()=>null);else if(i==="reject")return Promise.reject(n)}return X(u,c,n)},D=n=>n.name===J||n.name===ye,W=async(n,u=null)=>{let c=re(u||{}),p={...a,...c};r("retry",p,a,c),r("headers",p,a,c);let i=null,m=P(n,p),{timeout:S,cancellable:T,dedupeTime:_,pollingInterval:Z,shouldStopPolling:k,cacheTime:F,cacheKey:ee}=p,w;if(ee?w=ee(m):w=Oe(m),F&&w){let A=p.cacheBuster;if(!A||!A(m)){let l=Fe(w,F);if(l)return l.data}}let{retries:M=0,delay:Ae,backoff:ce,retryOn:te,shouldRetry:I,maxDelay:fe,resetTimeout:Ue}=p.retry,q=0,ae=0,E=Ae,pe=M>0?M:0;for(;q<=pe;)try{let l={signal:(await we(m,S,_,T,!!(S&&(!pe||Ue)))).signal,...m};if(await x(l,c==null?void 0:c.onRequest),await x(l,a==null?void 0:a.onRequest),d!==null&&y!==null&&typeof y.request===H?i=await y.request(l):i=await fetch(l.url,l),i instanceof Response&&(i.config=l,i.data=await xe(i),!i.ok))throw new j(`${l.url} failed! Status: ${i.status||null}`,l,i);if(await x(i,c==null?void 0:c.onResponse),await x(i,a==null?void 0:a.onResponse),K(m),I&&q<M&&await I({config:m,request:m,response:i},q)){f(p,`Attempt ${q+1} failed response data check. Retry in ${E}ms.`),await G(E),E*=ce,E=Math.min(E,fe),q++;continue}if(Z&&(!k||!k(i,ae))){ae++,f(l,"Polling attempt "+ae+"..."),await G(Z);continue}let se=X(i,l);if(F&&w){let de=l.skipCache;(!de||!de(se,l))&&Be(w,se)}return se}catch(A){let l=A;if(l.status=(l==null?void 0:l.status)||(i==null?void 0:i.status)||0,l.statusText=(l==null?void 0:l.statusText)||(i==null?void 0:i.statusText)||"",l.config=m,l.request=m,l.response=i,q===M||!(te!=null&&te.includes(l.status))||!await(I==null?void 0:I(l,q)))return await R(l,m),K(m),h(l,i,m);f(p,`Attempt ${q+1} failed. Retry in ${E}ms.`),await G(E),E*=ce,E=Math.min(E,fe),q++}return X(i,m)},X=(n,u,c=null)=>{let p=s(u,"defaultResponse");if(!n)return{ok:!1,error:c,data:p,headers:null,config:u};let i=n==null?void 0:n.data;return(i==null||typeof i===b&&Object.keys(i).length===0)&&(i=p),s(u,"flattenResponse")&&(n.data=ie(i)),n instanceof Response?{body:n.body,bodyUsed:n.bodyUsed,ok:n.ok,redirected:n.redirected,type:n.type,url:n.url,status:n.status,statusText:n.statusText,blob:()=>n.blob(),json:()=>n.json(),text:()=>n.text(),clone:()=>n.clone(),arrayBuffer:()=>n.arrayBuffer(),formData:()=>n.formData(),bytes:()=>n.bytes(),error:c,data:i,headers:be(n.headers),config:u}:n};return{getInstance:g,buildConfig:P,config:a,request:W}}function ft(e){let t=e.endpoints,a=Y(e);function r(){return a.getInstance()}function s(g){return console.error(`Add ${g} to 'endpoints'.`),Promise.resolve(null)}async function d(g,f={}){let o=t[g]||{url:String(g)},P=o.url;if(P.startsWith("//"))throw new Error("Protocol-relative URLs are not allowed.");return P.includes("://")?await Ie(P,f):await a.request(P,{...o,...f})}let y={config:e,endpoints:t,requestHandler:a,getInstance:r,request:d};return new Proxy(y,{get(g,f){return f in y?y[f]:t[f]?y.request.bind(null,f):s.bind(null,f)}})}async function Ie(e,t={}){return Y(t).request(e,t)}export{ft as createApiFetcher,Ie as fetchf};
//# sourceMappingURL=index.mjs.map